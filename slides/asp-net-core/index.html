<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Introduction à ASP.NET Core</title><link rel=stylesheet href=https://www.bpesquet.fr/reveal.js/dist/reveal.css><link rel=stylesheet href=https://www.bpesquet.fr/reveal.js/dist/theme/white.css></head><body><div class=reveal><div class=slides><section><h1>Introduction à ASP.NET Core</h1><p><a href=https://ensc.bordeaux-inp.fr>Ecole Nationale Supérieure de Cognitique</a></p><p><a href=https://www.bpesquet.fr>Baptiste Pesquet</a></p></section><section><h2 id=sommaire>Sommaire</h2><ul><li>Qu&rsquo;est-ce qu&rsquo;ASP.NET Core ?</li><li>Le framework ASP.NET Core MVC</li><li>Mécanismes fondamentaux</li></ul></section><section><h2 id=quest-ce-quaspnet-core->Qu&rsquo;est-ce qu&rsquo;ASP.NET Core ?</h2></section><section><h3 id=histoire-daspnet-core>Histoire d&rsquo;ASP.NET Core</h3><ul><li>A l&rsquo;origine, .NET (Framework) incluait une technologie de création de pages web dynamiques nommée <strong>ASP.NET</strong> (<em>Active Server Pages</em>).</li><li><strong>ASP.NET Core</strong> est une réécriture d&rsquo;ASP.NET basée sur .NET (Core).</li><li>Standard actuel pour le développement web sous .NET.</li></ul></section><section><h3 id=points-clés-daspnet-core>Points-clés d&rsquo;ASP.NET Core</h3><ul><li>Permet de créer des applications web et des services web (API) utilisés comme <em>backends</em> par des clients riches ou des applications mobiles.</li><li>Léger, moderne et modulaire.</li><li>Inclut des technologies facilitant la gestion des pages dynamiques, des appels temps réel, des tests, etc.</li><li>Déployable sur plusieurs serveurs web : Kestrel, Apache, nginx, etc.</li><li>Multi-plateformes et <a href=https://github.com/dotnet/aspnetcore>open source</a>.</li></ul></section><section><h3 id=ui-générée-côté-serveur>UI générée côté serveur</h3><p>Code HTML et CSS généré côté serveur, puis renvoyée au client.</p><ul><li>Peu d&rsquo;exigences techniques côté client (navigateur simple, trafic réseau limité).</li><li>Accès BD et contrôles centralisés.</li><li>Exemples d&rsquo;usages : sites dynamiques, blogs, CMS.</li></ul></section><section><h3 id=ui-générée-côté-client>UI générée côté client</h3><p>Structure HTML (DOM) mise à jour dynamiquement côté client grâce à des appels asynchrones au serveur.</p><ul><li>Interactions riches avec l&rsquo;utilisateur.</li><li>Capacités matérielles et logicielles du client utilisables.</li><li>Exemples d&rsquo;usages : tableau de bord interactif, applications collaboratives.</li></ul></section><section><h3 id=loffre-technique-aspnet-core>L&rsquo;offre technique ASP.NET Core</h3><ul><li>UI générée côté serveur : <strong>Razor Pages</strong>, <strong>MVC</strong>.</li><li>UI générée côté client : <strong>Blazor</strong>, <strong>SPA</strong> avec Angular ou React.</li><li>Une approche hybride est possible (exemple : MVC + Blazor).</li></ul></section><section><h2 id=le-framework-aspnet-core-mvc>Le framework ASP.NET Core MVC</h2></section><section><section data-shortcode-section><h3 id=rappel--le-fonctionnement-du-web>Rappel : le fonctionnement du web</h3><p>Le web est basé sur un modèle <strong>client/serveur</strong> :</p><ul><li>Le client (navigateur, application mobile, robot d&rsquo;indexation, etc) envoie une demande (<strong>requête</strong>) au serveur.</li><li>Le serveur prépare sa <strong>réponse</strong> à la requête du client, puis la lui renvoie.</li></ul></section><section><p><img src=images/web_request_response.png alt="Modèle requête/réponse du web"></p></section></section><section><h3 id=le-protocole-http>Le protocole HTTP</h3><ul><li><em>HyperText Transfer Protocol</em>.</li><li>Socle technique du web.</li><li>Equivalent sécurisé : <strong>HTTPS</strong>.</li><li>Basé sur des <strong>commandes</strong> textuelles exprimant les différentes actions possibles : <em>GET</em>, <em>PUT</em>, <em>POST</em>, etc).</li></ul></section><section><h3 id=larchitecture-mvc>L&rsquo;architecture MVC</h3><ul><li><em>Model-View-Controller</em> (<em>Modèle-Vue-Contrôleur</em>).</li><li>Décomposition d’une application en trois grandes parties :<ul><li><strong>Modèle</strong> : accès aux données et logique métier (<em>business logic</em>).</li><li><strong>Vue</strong> : affichage et interactions avec l’utilisateur.</li><li><strong>Contrôleur</strong> : dynamique de l’application, lien entre Modèle et Vue.</li></ul></li><li>Application du principe de séparation des responsabilités.</li></ul></section><section><h3 id=mvc--un-peu-dhistoire>MVC : un peu d&rsquo;histoire</h3><ul><li>Apparu à la fin des années 1970 pour le langage OO <strong>Smalltalk</strong>. Objectif : séparer le code de l’IHM de la logique applicative.</li><li>Appliqué depuis dans de très nombreux contextes et langages :<ul><li>web côté serveur : frameworks Symfony (PHP), Django (Python), Rails (Ruby), etc.</li><li>web côté client : frameworks Angular, Ember (JavaScript), etc.</li><li>desktop : bibliothèque Swing (Java), etc.</li></ul></li></ul></section><section><p><a href=https://symfony.com/doc/current/index.html><img src=images/symfony_mvc.png alt="Dynamique d&rsquo;un serveur web MVC"></a></p></section><section><h3 id=avantages-et-inconvénients>Avantages et inconvénients</h3><ul><li><p>Avantages :</p><ul><li>Clarification de l’architecture.</li><li>Séparation nette des responsabilités => couplage faible, cohésion forte, maintenance et évolutions facilitées.</li></ul></li><li><p>Inconvénients :</p><ul><li>Complexification de l’architecture.</li><li>Rigidité.</li></ul></li></ul></section><section><h3 id=aspnet-core-mvc>ASP.NET Core MVC</h3><ul><li>Framework de création d&rsquo;applications web basées sur l&rsquo;architecture MVC.</li><li>Implémente de nombreux services et bonnes pratiques, parmi lesquels :<ul><li>Routage des requêtes entrantes.</li><li>Gestion des pages dynamiques.</li><li>Authentification.</li><li>Injection de dépendance.</li><li>Tests.</li><li>&mldr;</li></ul></li></ul></section><section><h3 id=structure-dune-application-aspnet-core-mvc>Structure d&rsquo;une application ASP.NET Core MVC</h3><p><img src=images/aspnetcoremvc_structure.png alt="Structure d&rsquo;une application ASP.NET Core MVC"></p></section><section><h3 id=les-contrôleurs>Les contrôleurs</h3><ul><li>Créés dans le répertoire <code>Controllers/</code>.</li><li>Héritent de la classe abstraite <code>Controller</code>.</li><li>Définissent les points d&rsquo;entrée dans l&rsquo;application sous la forme de méthodes d&rsquo;action annotables.</li></ul><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> MoviesController : Controller
{
    <span style=color:#080;background-color:#0f140f;font-style:italic>// GET: Movies/Details/5
</span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task&lt;IActionResult&gt; Details(<span style=color:#cdcaa9;font-weight:700>int?</span> id)
    {
        <span style=color:#080;background-color:#0f140f;font-style:italic>//...
</span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    }

    <span style=color:#080;background-color:#0f140f;font-style:italic>// POST: Movies/Delete/5
</span><span style=color:#080;background-color:#0f140f;font-style:italic></span><span style=color:#ff0086;font-weight:700>    [HttpPost, ActionName(&#34;Delete&#34;)]</span>
<span style=color:#ff0086;font-weight:700>    [ValidateAntiForgeryToken]</span>
    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task&lt;IActionResult&gt; DeleteConfirmed(<span style=color:#cdcaa9;font-weight:700>int</span> id)
    {
        <span style=color:#080;background-color:#0f140f;font-style:italic>// ...
</span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    }
</code></pre></div></section><section><h3 id=les-modèles>Les modèles</h3><ul><li>Créés dans le répertoire <code>Models/</code>.</li><li>Implémentent la logique métier de l&rsquo;application sous la forme de classes <strong>POCO</strong> (<em>Plain Old CLR Objects</em>) souvent associées à des tables BD.</li></ul><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Movie
{
    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> Id { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
<span style=color:#ff0086;font-weight:700>
</span><span style=color:#ff0086;font-weight:700>    [StringLength(60, MinimumLength = 3)]</span>
    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Title { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
<span style=color:#ff0086;font-weight:700>
</span><span style=color:#ff0086;font-weight:700>    [Display(Name = &#34;Release Date&#34;), DataType(DataType.Date)]</span>
    <span style=color:#fb660a;font-weight:700>public</span> DateTime ReleaseDate { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...
</span></code></pre></div></section><section><h3 id=les-vues>Les vues</h3><ul><li>Créés dans le répertoire <code>Views/[Controller]</code> sous la forme de fichiers Razor (<code>.cshtml</code>).</li><li>Représentent l&rsquo;interface utilisateur (UI) de l&rsquo;application.</li></ul><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>@{
    ViewData[<span style=color:#0086d2>&#34;Title&#34;</span>] = <span style=color:#0086d2>&#34;About&#34;</span>;
}
&lt;h2&gt;@ViewData[<span style=color:#0086d2>&#34;Title&#34;</span>].&lt;/h2&gt;
&lt;h3&gt;@ViewData[<span style=color:#0086d2>&#34;Message&#34;</span>]&lt;/h3&gt;

&lt;p&gt;Use <span style=color:#fb660a;font-weight:700>this</span> area to provide additional information.&lt;/p&gt;
</code></pre></div></section><section><h3 id=code-et-librairies-client>Code et librairies client</h3><ul><li>Regroupés dans le répertoire <code>wwwroot/</code>.</li><li>Rassemblent les fichiers CSS et JavaScript utilisés côté client.</li><li>Incluent par défaut Bootstrap et jQuery.</li></ul></section><section><h3 id=le-fichier-appsettingsjson>Le fichier appsettings.json</h3><p>Centralise les paramètres de configuration de l&rsquo;application.</p><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#fb660a;font-weight:700>&#34;Logging&#34;</span>: {
    <span style=color:#fb660a;font-weight:700>&#34;LogLevel&#34;</span>: {
      <span style=color:#fb660a;font-weight:700>&#34;Default&#34;</span>: <span style=color:#0086d2>&#34;Information&#34;</span>,
      <span style=color:#fb660a;font-weight:700>&#34;Microsoft&#34;</span>: <span style=color:#0086d2>&#34;Warning&#34;</span>,
      <span style=color:#fb660a;font-weight:700>&#34;Microsoft.Hosting.Lifetime&#34;</span>: <span style=color:#0086d2>&#34;Information&#34;</span>,
      <span style=color:#fb660a;font-weight:700>&#34;Microsoft.EntityFrameworkCore.Database.Command&#34;</span>: <span style=color:#0086d2>&#34;Information&#34;</span>
    }
  },
  <span style=color:#fb660a;font-weight:700>&#34;AllowedHosts&#34;</span>: <span style=color:#0086d2>&#34;*&#34;</span>,
  <span style=color:#fb660a;font-weight:700>&#34;ConnectionStrings&#34;</span>: {
    <span style=color:#fb660a;font-weight:700>&#34;MvcMovieContext&#34;</span>: <span style=color:#0086d2>&#34;Data Source=MvcMovieContext-8719dcdb-c317-48bf-9cd8-a4c4167ce370.db&#34;</span>
  }
}
</code></pre></div></section><section><section data-shortcode-section><h3 id=le-fichier-startupcs>Le fichier Startup.cs</h3><p>Contient la classe <code>Startup</code> qui permet :</p><ul><li>la configuration des services utilisés par l&rsquo;application ;</li><li>la définition du <em>pipeline</em> de gestion des requêtes HTTP entrantes.</li></ul></section><section><h3 id=exemple-de-classe-startup>Exemple de classe Startup</h3><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Startup
{
    <span style=color:#080;background-color:#0f140f;font-style:italic>// Use this method to add services to the container.
</span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> ConfigureServices(IServiceCollection services)
    {
        services.AddControllersWithViews();
    }
    <span style=color:#080;background-color:#0f140f;font-style:italic>// Use this method to configure the HTTP request pipeline.
</span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
    {
        app.UseHttpsRedirection();
        app.UseStaticFiles();
        app.UseRouting();
        app.UseAuthorization();
        app.UseEndpoints(endpoints =&gt;
        {
            endpoints.MapDefaultControllerRoute();
        });
    }
}
</code></pre></div></section></section><section><h2 id=mécanismes-fondamentaux>Mécanismes fondamentaux</h2></section><section><section data-shortcode-section><h3 id=routage-des-requêtes>Routage des requêtes</h3><ul><li>Associe les requêtes HTTP entrantes au code à éxécuter (méthodes des contrôleurs).</li><li>Permet à l&rsquo;application web d&rsquo;utiliser des URL propres et <em>SEO-friendly</em>, plutôt que des noms de fichiers.</li><li><a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/controllers/routing?view=aspnetcore-5.0">Plus d&rsquo;informations</a>.</li></ul></section><section><h3 id=routage-par-convention>Routage par convention</h3><ul><li>Permet de définir globalement la correspondance entre le format de l&rsquo;URL et la méthode d&rsquo;action d&rsquo;un contrôleur à exécuter.</li><li>Format par défaut : <code>/[Controller]/[ActionName]/[Parameters]</code>.</li><li>Exemple : <code>https://myapp/Student/Details/Code=137</code> appelle la méthode <code>Details</code> du contrôleur <code>StudentController</code>, en lui passant un paramètre nommé <code>Code</code> ayant la valeur 137.</li></ul></section><section><h3 id=configuration-du-routage-par-convention-dans-startup>Configuration du routage par convention dans Startup</h3><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...
</span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    app.UseEndpoints(endpoints =&gt;
    {
        endpoints.MapControllerRoute(
            name: <span style=color:#0086d2>&#34;default&#34;</span>,
            pattern: <span style=color:#0086d2>&#34;{controller=Home}/{action=Index}/{id?}&#34;</span>);
    });
}
</code></pre></div><p><code>Home</code>, <code>Index</code> et <code>id</code> sont resp. les noms par défaut du contrôleur, de l&rsquo;action et du paramètre (optionnel).</p></section></section><section><h3 id=scaffolding>Scaffolding</h3><p><code>> dotnet-aspnet-codegenerator [arguments]</code></p><ul><li>Permet de générer le code source pour les opérations élémentaires <strong>CRUD</strong> (<em>Create, Read, Update, Delete</em>) liées à une classe du Modèle.</li><li><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/tools/dotnet-aspnet-codegenerator?view=aspnetcore-5.0">Plus d&rsquo;informations</a>.</li><li><a href=https://github.com/ensc-glog/MvcMovie/commit/f5c4ec45033f5509ec736bc1bebf010f200921f0>Exemple de résultat</a>.</li></ul></section><section><h3 id=database-context>Database context</h3><ul><li>Hérite de la classe abstraite <code>DbContext</code>.</li><li>Spécifit les classes du Modèle à sauvegarder dans la base de données.</li></ul><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> MvcMovieContext : DbContext
{
    <span style=color:#fb660a;font-weight:700>public</span> MvcMovieContext(DbContextOptions&lt;MvcMovieContext&gt; options)
        : <span style=color:#fb660a;font-weight:700>base</span>(options)
    {}
    <span style=color:#fb660a;font-weight:700>public</span> DbSet&lt;MvcMovie.Models.Movie&gt; Movie { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
}
</code></pre></div><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> ConfigureServices(IServiceCollection services)
{
    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...
</span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    services.AddDbContext&lt;MvcMovieContext&gt;(options =&gt;
            options.UseSqlite(Configuration.GetConnectionString(<span style=color:#0086d2>&#34;MvcMovieContext&#34;</span>)));
}
</code></pre></div></section><section><h3 id=migrations>Migrations</h3><p><code>> dotnet ef migrations add InitialCreate</code></p><p><code>> dotnet ef database update</code></p><ul><li>Permettent à la base de données d&rsquo;être synchronisée avec les évolutions du Modèle, sans perte de données.</li><li>Migration = évolution incrémentale depuis la migration précédente.</li></ul></section><section><section data-shortcode-section><h3 id=envoi-de-données-aux-vues--viewdata>Envoi de données aux vues : ViewData</h3><p>Approche <em>faiblement typée</em> : on utilie un dictionnaire standard.</p><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#fb660a;font-weight:700>public</span> IActionResult Welcome(<span style=color:#cdcaa9;font-weight:700>string</span> name, <span style=color:#cdcaa9;font-weight:700>int</span> numTimes = <span style=color:#0086f7;font-weight:700>1</span>)
{
    ViewData[<span style=color:#0086d2>&#34;Message&#34;</span>] = <span style=color:#0086d2>&#34;Hello &#34;</span> + name;
    ViewData[<span style=color:#0086d2>&#34;NumTimes&#34;</span>] = numTimes;
    <span style=color:#fb660a;font-weight:700>return</span> View();
}
</code></pre></div></section><section><h3 id=utilisation-dans-la-vue>Utilisation dans la vue</h3><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>@{
    ViewData[<span style=color:#0086d2>&#34;Title&#34;</span>] = <span style=color:#0086d2>&#34;Welcome&#34;</span>;
}
&lt;h2&gt;Welcome&lt;/h2&gt;
&lt;ul&gt;
    @for (<span style=color:#cdcaa9;font-weight:700>int</span> i = <span style=color:#0086f7;font-weight:700>0</span>; i &lt; (<span style=color:#cdcaa9;font-weight:700>int</span>)ViewData[<span style=color:#0086d2>&#34;NumTimes&#34;</span>]; i++)
    {
        &lt;li&gt;@ViewData[<span style=color:#0086d2>&#34;Message&#34;</span>]&lt;/li&gt;
    }
&lt;/ul&gt;
</code></pre></div></section></section><section><section data-shortcode-section><h3 id=envoi-de-données-aux-vues--viewmodel>Envoi de données aux vues : ViewModel</h3><p>Approche <em>fortement typée</em> : on définit une classe pour porter les données de la vue.</p><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Address
{
    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Name { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Street { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> City { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> State { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> PostalCode { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
}
</code></pre></div></section><section><h3 id=utilisation-dans-le-contrôleur>Utilisation dans le contrôleur</h3><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#fb660a;font-weight:700>public</span> IActionResult Contact()
{
    <span style=color:#cdcaa9;font-weight:700>var</span> viewModel = <span style=color:#fb660a;font-weight:700>new</span> Address()
    {
        Name = <span style=color:#0086d2>&#34;Microsoft&#34;</span>,
        Street = <span style=color:#0086d2>&#34;One Microsoft Way&#34;</span>,
        City = <span style=color:#0086d2>&#34;Redmond&#34;</span>,
        State = <span style=color:#0086d2>&#34;WA&#34;</span>,
        PostalCode = <span style=color:#0086d2>&#34;98052-6399&#34;</span>
    };
    <span style=color:#fb660a;font-weight:700>return</span> View(viewModel);
}
</code></pre></div></section><section><h3 id=utilisation-dans-la-vue>Utilisation dans la vue</h3><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>@model WebApplication1.ViewModels.Address
<p>&lt;<span style=color:#fb660a;font-weight:700>h2</span>&gt;Contact&lt;/<span style=color:#fb660a;font-weight:700>h2</span>&gt;
&lt;<span style=color:#fb660a;font-weight:700>address</span>&gt;
@Model.Street&lt;<span style=color:#fb660a;font-weight:700>br</span> /&gt;
@Model.City, @Model.State @Model.PostalCode&lt;<span style=color:#fb660a;font-weight:700>br</span> /&gt;
&lt;<span style=color:#fb660a;font-weight:700>abbr</span> <span style=color:#ff0086;font-weight:700>title</span>=<span style=color:#0086d2>&quot;Phone&quot;</span>&gt;P:&lt;/<span style=color:#fb660a;font-weight:700>abbr</span>&gt; 425.555.0100
&lt;/<span style=color:#fb660a;font-weight:700>address</span>&gt;
</code></pre></div></p></section></section><section><section data-shortcode-section><h3 id=view-layout>View layout</h3><ul><li>Par défaut, toutes les vues partagent une structure commune définie dans le fichier <code>Views/Shared/_Layout.cshtml</code>.</li><li>Dans ce layout, la fonction <code>@RenderBody()</code> permet de générer le contenu spécifique de la vue à afficher.</li><li>Les éléments spécifiques à une vue (exemples : inclusions CSS ou JavaScript) peuvent être rassemblés dans des <strong>sections</strong> affichées par le layout.</li></ul></section><section><h3 id=exemple-de-layout>Exemple de layout</h3><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#ff0007;background-color:#0f140f;font-weight:700;font-style:italic>&lt;!DOCTYPE html&gt;</span>
&lt;<span style=color:#fb660a;font-weight:700>html</span> <span style=color:#ff0086;font-weight:700>lang</span>=<span style=color:#0086d2>&#34;en&#34;</span>&gt;
  &lt;<span style=color:#fb660a;font-weight:700>head</span>&gt;
    &lt;<span style=color:#fb660a;font-weight:700>meta</span> <span style=color:#ff0086;font-weight:700>charset</span>=<span style=color:#0086d2>&#34;utf-8&#34;</span> /&gt;
    &lt;<span style=color:#fb660a;font-weight:700>title</span>&gt;@ViewData[&#34;Title&#34;] - Movie App&lt;/<span style=color:#fb660a;font-weight:700>title</span>&gt;
    <span style=color:#080;background-color:#0f140f;font-style:italic>&lt;!-- ... --&gt;</span>
  &lt;/<span style=color:#fb660a;font-weight:700>head</span>&gt;
  &lt;<span style=color:#fb660a;font-weight:700>body</span>&gt;
    &lt;<span style=color:#fb660a;font-weight:700>header</span>&gt;<span style=color:#080;background-color:#0f140f;font-style:italic>&lt;!-- ... --&gt;</span>&lt;/<span style=color:#fb660a;font-weight:700>header</span>&gt;
    &lt;<span style=color:#fb660a;font-weight:700>div</span> <span style=color:#ff0086;font-weight:700>class</span>=<span style=color:#0086d2>&#34;container&#34;</span>&gt;
      &lt;<span style=color:#fb660a;font-weight:700>main</span> <span style=color:#ff0086;font-weight:700>role</span>=<span style=color:#0086d2>&#34;main&#34;</span> <span style=color:#ff0086;font-weight:700>class</span>=<span style=color:#0086d2>&#34;pb-3&#34;</span>&gt;@RenderBody()&lt;/<span style=color:#fb660a;font-weight:700>main</span>&gt;
    &lt;/<span style=color:#fb660a;font-weight:700>div</span>&gt;
    &lt;<span style=color:#fb660a;font-weight:700>footer</span>&gt;<span style=color:#080;background-color:#0f140f;font-style:italic>&lt;!-- ... --&gt;</span>&lt;/<span style=color:#fb660a;font-weight:700>footer</span>&gt;
    &lt;<span style=color:#fb660a;font-weight:700>script</span> <span style=color:#ff0086;font-weight:700>src</span>=<span style=color:#0086d2>&#34;~/lib/jquery/dist/jquery.min.js&#34;</span>&gt;&lt;/<span style=color:#fb660a;font-weight:700>script</span>&gt;
    <span style=color:#080;background-color:#0f140f;font-style:italic>&lt;!-- ... --&gt;</span>
    @await RenderSectionAsync(&#34;Scripts&#34;, required: false)
  &lt;/<span style=color:#fb660a;font-weight:700>body</span>&gt;
&lt;/<span style=color:#fb660a;font-weight:700>html</span>&gt;
</code></pre></div></section></section><section><section data-shortcode-section><h3 id=validation-des-données>Validation des données</h3><p>L&rsquo;annotation des classes du Modèle permet de définir des <strong>règles de validation</strong> qui seront automatiquement vérifiées à la fois côté serveur et côté client.</p><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#fb660a;font-weight:700>using</span> System.ComponentModel.DataAnnotations;
<span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> LoginViewModel
{
<span style=color:#ff0086;font-weight:700>    [Required]</span>
<span style=color:#ff0086;font-weight:700>    [EmailAddress]</span>
    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Email { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
<span style=color:#ff0086;font-weight:700>
</span><span style=color:#ff0086;font-weight:700>    [Required]</span>
<span style=color:#ff0086;font-weight:700>    [DataType(DataType.Password)]</span>
    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Password { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
<span style=color:#ff0086;font-weight:700>
</span><span style=color:#ff0086;font-weight:700>    [Display(Name = &#34;Remember me?&#34;)]</span>
    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>bool</span> RememberMe { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
}
</code></pre></div></section><section><h3 id=validation-dans-le-contrôleur>Validation dans le contrôleur</h3><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task&lt;IActionResult&gt; Login(LoginViewModel model, <span style=color:#cdcaa9;font-weight:700>string</span> returnUrl = <span style=color:#fb660a;font-weight:700>null</span>)
{
    <span style=color:#080;background-color:#0f140f;font-style:italic>// Check model validation rules
</span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#fb660a;font-weight:700>if</span> (ModelState.IsValid)
    {
      <span style=color:#080;background-color:#0f140f;font-style:italic>// ... (nominal case: work with the model)
</span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    }
    <span style=color:#080;background-color:#0f140f;font-style:italic>// At this point, something failed: redisplay form
</span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#fb660a;font-weight:700>return</span> View(model);
}
</code></pre></div></section></section><section><section data-shortcode-section><h3 id=environnements>Environnements</h3><ul><li>Permettent d&rsquo;adapter la configuration de l&rsquo;application au contexte (développement, test ou production).</li><li>Définis par la variable d&rsquo;environnement <code>ASPNETCORE_ENVIRONMENT</code>. En l&rsquo;absence de cette variable, l&rsquo;environnement est de type Production.</li><li><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-5.0">Plus d&rsquo;informations</a>.</li></ul></section><section><h3 id=définition-de-lenvironnement-avec-visual-studio-code>Définition de l&rsquo;environnement avec Visual Studio Code</h3><p>Fichier <code>./vscode/launch.json</code></p><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#fb660a;font-weight:700>&#34;version&#34;</span>: <span style=color:#0086d2>&#34;0.2.0&#34;</span>,
  <span style=color:#fb660a;font-weight:700>&#34;configurations&#34;</span>: [
    {
      <span style=color:#fb660a;font-weight:700>&#34;name&#34;</span>: <span style=color:#0086d2>&#34;.NET Core Launch (web)&#34;</span>,
      # ...
      <span style=color:#fb660a;font-weight:700>&#34;env&#34;</span>: {
        <span style=color:#fb660a;font-weight:700>&#34;ASPNETCORE_ENVIRONMENT&#34;</span>: <span style=color:#0086d2>&#34;Development&#34;</span>
      },
      # ...
    }
  ]
}
<p></code></pre></div></section><section></p><h3 id=configuration-de-lapplication-selon-lenvironnement-détecté>Configuration de l&rsquo;application selon l&rsquo;environnement détecté</h3><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    <span style=color:#fb660a;font-weight:700>if</span> (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
    }
    <span style=color:#fb660a;font-weight:700>if</span> (env.IsProduction() || env.IsStaging())
    {
        app.UseExceptionHandler(<span style=color:#0086d2>&#34;/Error&#34;</span>);
    }
    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...
</span></code></pre></div></section></section></div></div><div><a href=https://ensc.bordeaux-inp.fr><img src=https://www.bpesquet.fr/images/ENSC.jpg style=position:absolute;bottom:10px;left:10px></a></div><script src=https://www.bpesquet.fr/reveal.js/dist/reveal.js></script><script src=https://www.bpesquet.fr/reveal.js/plugin/math/math.js></script><script>Reveal.initialize({history:false,slideNumber:true,transition:"convex",math:{mathjax:'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',config:'TeX-MML-AM_HTMLorMML'},dependencies:[{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/markdown\/marked.js'},{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/markdown\/markdown.js'},{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/notes\/notes.js',async:true},{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/zoom-js\/zoom.js',async:true},{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/highlight\/highlight.js',async:true,callback:function(){hljs.initHighlightingOnLoad();}},],plugins:[RevealMath]});</script></body></html>