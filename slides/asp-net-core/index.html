<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>ASP.NET Core</title><link rel=stylesheet href=https://www.bpesquet.fr/reveal.js/dist/reveal.css><link rel=stylesheet href=https://www.bpesquet.fr/reveal.js/dist/theme/white.css></head><body><div class=reveal><div class=slides><section><h1>ASP.NET Core</h1><p><a href=https://ensc.bordeaux-inp.fr>Ecole Nationale Supérieure de Cognitique</a></p><p><a href=https://www.bpesquet.fr>Baptiste Pesquet</a></p></section><section><h2 id=sommaire>Sommaire
<span><a href=#sommaire><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><ul><li>Introduction à .NET</li><li>Présentation de ASP.NET Core</li><li>Le framework ASP.NET Core MVC</li><li>Mécanismes fondamentaux</li><li>Création d&rsquo;API web</li><li>Interactions avec une base de données</li><li>Tests</li></ul></section><section><h2 id=introduction-à-net>Introduction à .NET
<span><a href=#introduction-%c3%a0-net><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><h3 id=aux-origines-de-net>Aux origines de .NET
<span><a href=#aux-origines-de-net><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Plate-forme de développement d&rsquo;applications créée par Microsoft en 2002.</li><li>Réponse à la domination du langage Java (multi-plateformes).</li><li>Inclut plusieurs langages de programmation : C#, VB.NET, F#, PowerShell&mldr;</li><li>Uniquement disponible sous Windows.</li><li>Licence propriétaire.</li></ul></section><section><p><a href=https://en.wikipedia.org/wiki/.NET_Framework><img src=images/dotnet_stack.png alt="Pile .NET"></a></p></section><section><section data-shortcode-section><h3 id=architecture-technique-de-net>Architecture technique de .NET
<span><a href=#architecture-technique-de-net><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Une application .NET s&rsquo;exécute dans un environnement contrôlé appelé <strong>CLR</strong> (<em>Common Language Runtime</em>).</li><li>La compilation du code source produit un résultat indépendant du système d&rsquo;exploitation, conformément à un standard nommé <strong>CLI</strong> (<em>Common Language Infrastructure</em>).</li></ul></section><section><p><a href=https://en.wikipedia.org/wiki/Common_Language_Infrastructure><img src=images/dotnet_cli_clr.png alt="CLI et CLR"></a></p></section></section><section><h3 id=net-framework-et-net-core>.NET Framework et .NET Core
<span><a href=#net-framework-et-net-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><a href=https://www.mono-project.com/docs/about-mono/history/>2004</a> : le projet <strong>Mono</strong>, indépendant de Microsoft, débute le portage de .NET vers Linux.</li><li><a href=https://devblogs.microsoft.com/dotnet/net-core-is-open-source/>2014</a> : Microsoft publie <strong>.NET Core</strong>, la première version open source et multi-plateformes de .NET. La version WIndows-only de .NET est renommée <strong>.NET Framework</strong>.</li><li><a href=https://devblogs.microsoft.com/dotnet/net-core-is-the-future-of-net/>2019</a> : la nouvelle version de .NET Core est renommée <strong>.NET</strong>, et .NET Framework passe en mode maintenance.</li></ul></section><section><p><a href=https://devblogs.microsoft.com/dotnet/introducing-net-5/><img src=images/dotnet5_platform.png alt=".NET 5"></a></p></section><section><h3 id=la-ligne-de-commande-net>La ligne de commande .NET
<span><a href=#la-ligne-de-commande-net><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><strong>.NET CLI</strong> (<em>Command Line Interface</em>) permet d&rsquo;interagir avec .NET depuis un terminal.</li><li>Nécessite que .NET soit installé sur la machine.</li><li>Syntaxe : <code>dotnet &lt;commande> &lt;options></code></li></ul></section><section><h3 id=création-dune-application>Création d&rsquo;une application
<span><a href=#cr%c3%a9ation-dune-application><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet new &lt;template> -o &lt;output directory></code></p><table><thead><tr><th>Type d&rsquo;application</th><th>Template</th></tr></thead><tbody><tr><td>Console</td><td><code>console</code></td></tr><tr><td>Bibliothèque de classes</td><td><code>classlib</code></td></tr><tr><td>ASP.NET (vide)</td><td><code>web</code></td></tr><tr><td>ASP.NET (API)</td><td><code>webapi</code></td></tr><tr><td>ASP.NET (MVC)</td><td><code>mvc</code></td></tr></tbody></table></section><section><h3 id=création-dun-fichier-gitignore>Création d&rsquo;un fichier .gitignore
<span><a href=#cr%c3%a9ation-dun-fichier-gitignore><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet new gitignore</code></p><ul><li>Le fichier <code>.gitignore</code> permet d&rsquo;exclure certains fichiers/dossiers de la gestion des versions avec <a href=https://git-scm.com/>Git</a>. Il le plus souvent s&rsquo;agit de fichiers locaux (exemple : configuration de l&rsquo;environnement de développement) ou de fichiers recréés systématiquement par le processus de génération de l&rsquo;application.</li><li>Cette commande crée un fichier <code>.gitignore</code> adapté aux projets .NET.</li></ul></section><section><h3 id=gestion-des-packages>Gestion des packages
<span><a href=#gestion-des-packages><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet add package &lt;name></code></p><ul><li>Utilise <a href=https://www.nuget.org/>NuGet</a> pour télécharger un package et l&rsquo;ajouter au projet.</li><li>Vérifie la compatibilité du package à installer avec le projet.</li></ul><p><code>> dotnet list package</code></p><ul><li>Liste les packages installés pour un projet.</li></ul></section><section><h3 id=lancement-dune-application>Lancement d&rsquo;une application
<span><a href=#lancement-dune-application><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet run</code></p><p>Si nécessaire, effectue la restauration des dépendances du projet (équivalent de <code>dotnet restore</code>).</p></section><section><h3 id=surveillance-des-changements>Surveillance des changements
<span><a href=#surveillance-des-changements><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet watch run</code></p><p>Pour une application web, jnjecte un script qui met à jour le contenu affiché par le navigateur lorsque des fichiers surveillés sont modifiés.</p></section><section><h3 id=autres-possibilités>Autres possibilités
<span><a href=#autres-possibilit%c3%a9s><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Nettoyage, test, publication, gestion des packages installés, etc.</li><li><a href=https://docs.microsoft.com/en-us/dotnet/core/tools/>Plus d&rsquo;informations</a>.</li></ul></section><section><h2 id=présentation-daspnet-core>Présentation d&rsquo;ASP.NET Core
<span><a href=#pr%c3%a9sentation-daspnet-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><h3 id=histoire-daspnet-core>Histoire d&rsquo;ASP.NET Core
<span><a href=#histoire-daspnet-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>A l&rsquo;origine, .NET (Framework) incluait une technologie de création de pages web dynamiques nommée <strong>ASP.NET</strong> (<em>Active Server Pages</em>).</li><li><strong>ASP.NET Core</strong> est une réécriture d&rsquo;ASP.NET basée sur .NET (Core).</li><li>Standard actuel pour le développement web sous .NET.</li></ul></section><section><h3 id=points-clés-daspnet-core>Points-clés d&rsquo;ASP.NET Core
<span><a href=#points-cl%c3%a9s-daspnet-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Permet de créer des applications web et des services web (API) utilisés comme <em>backends</em> par des clients riches ou des applications mobiles.</li><li>Léger, moderne et modulaire.</li><li>Inclut des technologies facilitant la gestion des pages dynamiques, des appels temps réel, des tests, etc.</li><li>Déployable sur plusieurs serveurs web : Kestrel, Apache, nginx, etc.</li><li>Multi-plateformes et <a href=https://github.com/dotnet/aspnetcore>open source</a>.</li></ul></section><section><h3 id=ui-générée-côté-serveur>UI générée côté serveur
<span><a href=#ui-g%c3%a9n%c3%a9r%c3%a9e-c%c3%b4t%c3%a9-serveur><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Code HTML et CSS généré côté serveur, puis renvoyée au client.</p><ul><li>Peu d&rsquo;exigences techniques côté client (navigateur simple, trafic réseau limité).</li><li>Accès BD et contrôles centralisés.</li><li>Exemples d&rsquo;usages : sites dynamiques, blogs, CMS.</li></ul></section><section><h3 id=ui-générée-côté-client>UI générée côté client
<span><a href=#ui-g%c3%a9n%c3%a9r%c3%a9e-c%c3%b4t%c3%a9-client><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Structure HTML (DOM) mise à jour dynamiquement côté client grâce à des appels asynchrones au serveur.</p><ul><li>Interactions riches avec l&rsquo;utilisateur.</li><li>Capacités matérielles et logicielles du client utilisables.</li><li>Exemples d&rsquo;usages : tableau de bord interactif, applications collaboratives.</li></ul></section><section><h3 id=loffre-technique-aspnet-core>L&rsquo;offre technique ASP.NET Core
<span><a href=#loffre-technique-aspnet-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>UI générée côté serveur : <strong>Razor Pages</strong>, <strong>MVC</strong>.</li><li>UI générée côté client : <strong>Blazor</strong>, <strong>SPA</strong> avec Angular ou React.</li><li>Une approche hybride est possible (exemple : MVC + Blazor).</li></ul></section><section><h2 id=le-framework-aspnet-core-mvc>Le framework ASP.NET Core MVC
<span><a href=#le-framework-aspnet-core-mvc><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><section data-shortcode-section><h3 id=rappel--le-fonctionnement-du-web>Rappel : le fonctionnement du web
<span><a href=#rappel--le-fonctionnement-du-web><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Le web est basé sur un modèle <strong>client/serveur</strong> :</p><ul><li>Le client (navigateur, application mobile, robot d&rsquo;indexation, etc) envoie une demande (<strong>requête</strong>) au serveur.</li><li>Le serveur prépare sa <strong>réponse</strong> à la requête du client, puis la lui renvoie.</li></ul></section><section><p><img src=images/web_request_response.png alt="Modèle requête/réponse du web"></p></section></section><section><h3 id=le-protocole-http>Le protocole HTTP
<span><a href=#le-protocole-http><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><em>HyperText Transfer Protocol</em>.</li><li>Socle technique du web.</li><li>Equivalent sécurisé : <strong>HTTPS</strong>.</li><li>Basé sur des <strong>commandes</strong> textuelles exprimant les différentes actions possibles : <em>GET</em>, <em>PUT</em>, <em>POST</em>, etc).</li></ul></section><section><h3 id=larchitecture-mvc>L&rsquo;architecture MVC
<span><a href=#larchitecture-mvc><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><em>Model-View-Controller</em> (<em>Modèle-Vue-Contrôleur</em>).</li><li>Décomposition d’une application en trois grandes parties :<ul><li><strong>Modèle</strong> : accès aux données et logique métier (<em>business logic</em>).</li><li><strong>Vue</strong> : affichage et interactions avec l’utilisateur.</li><li><strong>Contrôleur</strong> : dynamique de l’application, lien entre Modèle et Vue.</li></ul></li><li>Application du principe de séparation des responsabilités.</li></ul></section><section><h3 id=mvc--un-peu-dhistoire>MVC : un peu d&rsquo;histoire
<span><a href=#mvc--un-peu-dhistoire><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Apparu à la fin des années 1970 pour le langage OO <strong>Smalltalk</strong>. Objectif : séparer le code de l’IHM de la logique applicative.</li><li>Appliqué depuis dans de très nombreux contextes et langages :<ul><li>web côté serveur : frameworks Symfony (PHP), Django (Python), Rails (Ruby), etc.</li><li>web côté client : frameworks Angular, Ember (JavaScript), etc.</li><li>desktop : bibliothèque Swing (Java), etc.</li></ul></li></ul></section><section><p><a href=https://symfony.com/doc/current/index.html><img src=images/symfony_mvc.png alt="Dynamique d&amp;rsquo;un serveur web MVC"></a></p></section><section><h3 id=avantages-et-inconvénients>Avantages et inconvénients
<span><a href=#avantages-et-inconv%c3%a9nients><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><p>Avantages :</p><ul><li>Clarification de l’architecture.</li><li>Séparation nette des responsabilités => couplage faible, cohésion forte, maintenance et évolutions facilitées.</li></ul></li><li><p>Inconvénients :</p><ul><li>Complexification de l’architecture.</li><li>Rigidité.</li></ul></li></ul></section><section><h3 id=aspnet-core-mvc>ASP.NET Core MVC
<span><a href=#aspnet-core-mvc><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Framework de création d&rsquo;applications web basées sur l&rsquo;architecture MVC.</li><li>Implémente de nombreux services et bonnes pratiques, parmi lesquels :<ul><li>Routage des requêtes entrantes.</li><li>Gestion des pages dynamiques.</li><li>Authentification.</li><li>Injection de dépendance.</li><li>Tests.</li><li>&mldr;</li></ul></li></ul></section><section><h3 id=structure-dune-application-aspnet-core-mvc>Structure d&rsquo;une application ASP.NET Core MVC
<span><a href=#structure-dune-application-aspnet-core-mvc><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><img src=images/aspnetcoremvc_structure.png alt="Structure d&amp;rsquo;une application ASP.NET Core MVC"></p></section><section><h3 id=les-contrôleurs>Les contrôleurs
<span><a href=#les-contr%c3%b4leurs><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Créés dans le répertoire <code>Controllers/</code>.</li><li>Héritent de la classe abstraite <code>Controller</code>.</li><li>Définissent les points d&rsquo;entrée dans l&rsquo;application sous la forme de méthodes d&rsquo;action annotables.</li></ul><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> MoviesController : Controller
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// GET: Movies/Details/5</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task&lt;IActionResult&gt; Details(<span style=color:#cdcaa9;font-weight:700>int?</span> id)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>//...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// POST: Movies/Delete/5</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [HttpPost, ActionName(&#34;Delete&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [ValidateAntiForgeryToken]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task&lt;IActionResult&gt; DeleteConfirmed(<span style=color:#cdcaa9;font-weight:700>int</span> id)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div></section><section><h3 id=les-modèles>Les modèles
<span><a href=#les-mod%c3%a8les><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Créés dans le répertoire <code>Models/</code>.</li><li>Implémentent la logique métier de l&rsquo;application sous la forme de classes <strong>POCO</strong> (<em>Plain Old CLR Objects</em>) souvent associées à des tables BD.</li></ul><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Movie
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> Id { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>
</span></span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [StringLength(60, MinimumLength = 3)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Title { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>
</span></span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Display(Name = &#34;Release Date&#34;), DataType(DataType.Date)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> DateTime ReleaseDate { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span></code></pre></div></section><section><h3 id=les-vues>Les vues
<span><a href=#les-vues><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Créés dans le répertoire <code>Views/[Controller]</code> sous la forme de fichiers Razor (<code>.cshtml</code>).</li><li>Représentent l&rsquo;interface utilisateur (UI) de l&rsquo;application.</li></ul><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>@{
</span></span><span style=display:flex><span>    ViewData[<span style=color:#0086d2>&#34;Title&#34;</span>] = <span style=color:#0086d2>&#34;About&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>&lt;h2&gt;@ViewData[<span style=color:#0086d2>&#34;Title&#34;</span>].&lt;/h2&gt;
</span></span><span style=display:flex><span>&lt;h3&gt;@ViewData[<span style=color:#0086d2>&#34;Message&#34;</span>]&lt;/h3&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;p&gt;Use <span style=color:#fb660a;font-weight:700>this</span> area to provide additional information.&lt;/p&gt;
</span></span></code></pre></div></section><section><h3 id=code-et-librairies-client>Code et librairies client
<span><a href=#code-et-librairies-client><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Regroupés dans le répertoire <code>wwwroot/</code>.</li><li>Rassemblent les fichiers CSS et JavaScript utilisés côté client.</li><li>Incluent par défaut Bootstrap et jQuery.</li></ul></section><section><h3 id=le-fichier-appsettingsjson>Le fichier appsettings.json
<span><a href=#le-fichier-appsettingsjson><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Centralise les paramètres de configuration de l&rsquo;application.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#fb660a;font-weight:700>&#34;Logging&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>&#34;LogLevel&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;Default&#34;</span>: <span style=color:#0086d2>&#34;Information&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;Microsoft&#34;</span>: <span style=color:#0086d2>&#34;Warning&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;Microsoft.Hosting.Lifetime&#34;</span>: <span style=color:#0086d2>&#34;Information&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;Microsoft.EntityFrameworkCore.Database.Command&#34;</span>: <span style=color:#0086d2>&#34;Information&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#fb660a;font-weight:700>&#34;AllowedHosts&#34;</span>: <span style=color:#0086d2>&#34;*&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#fb660a;font-weight:700>&#34;ConnectionStrings&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>&#34;MvcMovieContext&#34;</span>: <span style=color:#0086d2>&#34;Data Source=MvcMovieContext-8719dcdb-c317-48bf-9cd8-a4c4167ce370.db&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><section data-shortcode-section><h3 id=le-fichier-startupcs>Le fichier Startup.cs
<span><a href=#le-fichier-startupcs><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Contient la classe <code>Startup</code> qui permet :</p><ul><li>la configuration des services utilisés par l&rsquo;application ;</li><li>la définition du <em>pipeline</em> de gestion des requêtes HTTP entrantes.</li></ul></section><section><h3 id=exemple-de-classe-startup>Exemple de classe Startup
<span><a href=#exemple-de-classe-startup><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Startup
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// Use this method to add services to the container.</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> ConfigureServices(IServiceCollection services)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        services.AddControllersWithViews();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// Use this method to configure the HTTP request pipeline.</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        app.UseHttpsRedirection();
</span></span><span style=display:flex><span>        app.UseStaticFiles();
</span></span><span style=display:flex><span>        app.UseRouting();
</span></span><span style=display:flex><span>        app.UseAuthorization();
</span></span><span style=display:flex><span>        app.UseEndpoints(endpoints =&gt;
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            endpoints.MapDefaultControllerRoute();
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section></section><section><h2 id=mécanismes-fondamentaux>Mécanismes fondamentaux
<span><a href=#m%c3%a9canismes-fondamentaux><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><section data-shortcode-section><h3 id=routage-des-requêtes>Routage des requêtes
<span><a href=#routage-des-requ%c3%aates><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Associe les requêtes HTTP entrantes au code à éxécuter (méthodes des contrôleurs).</li><li>Permet à l&rsquo;application web d&rsquo;utiliser des URL propres et <em>SEO-friendly</em>, plutôt que des noms de fichiers.</li><li><a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/controllers/routing?view=aspnetcore-5.0">Plus d&rsquo;informations</a>.</li></ul></section><section><h3 id=routage-par-convention>Routage par convention
<span><a href=#routage-par-convention><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Permet de définir globalement la correspondance entre le format de l&rsquo;URL et la méthode d&rsquo;action d&rsquo;un contrôleur à exécuter.</li><li>Format par défaut : <code>/[Controller]/[ActionName]/[Parameters]</code>.</li><li>Exemple : <code>https://myapp/Student/Details/Code=137</code> appelle la méthode <code>Details</code> du contrôleur <code>StudentController</code>, en lui passant un paramètre nommé <code>Code</code> ayant la valeur 137.</li></ul></section><section><h3 id=configuration-du-routage-par-convention-dans-startup>Configuration du routage par convention dans Startup
<span><a href=#configuration-du-routage-par-convention-dans-startup><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    app.UseEndpoints(endpoints =&gt;
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        endpoints.MapControllerRoute(
</span></span><span style=display:flex><span>            name: <span style=color:#0086d2>&#34;default&#34;</span>,
</span></span><span style=display:flex><span>            pattern: <span style=color:#0086d2>&#34;{controller=Home}/{action=Index}/{id?}&#34;</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>Home</code>, <code>Index</code> et <code>id</code> sont resp. les noms par défaut du contrôleur, de l&rsquo;action et du paramètre (optionnel).</p></section></section><section><h3 id=scaffolding>Scaffolding
<span><a href=#scaffolding><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet-aspnet-codegenerator [arguments]</code></p><ul><li>Permet de générer le code source pour les opérations élémentaires <strong>CRUD</strong> (<em>Create, Read, Update, Delete</em>) liées à une classe du Modèle.</li><li><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/tools/dotnet-aspnet-codegenerator?view=aspnetcore-5.0">Plus d&rsquo;informations</a>.</li><li><a href=https://github.com/ensc-glog/MvcMovie/commit/f5c4ec45033f5509ec736bc1bebf010f200921f0>Exemple de résultat</a>.</li></ul></section><section><h3 id=database-context>Database context
<span><a href=#database-context><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Hérite de la classe abstraite <code>DbContext</code>.</li><li>Spécifie les classes du modèle à sauvegarder dans la base de données.</li></ul><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> MvcMovieContext : DbContext
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> MvcMovieContext(DbContextOptions&lt;MvcMovieContext&gt; options)
</span></span><span style=display:flex><span>        : <span style=color:#fb660a;font-weight:700>base</span>(options)
</span></span><span style=display:flex><span>    {}
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> DbSet&lt;MvcMovie.Models.Movie&gt; Movie { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> ConfigureServices(IServiceCollection services)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    services.AddDbContext&lt;MvcMovieContext&gt;(options =&gt;
</span></span><span style=display:flex><span>            options.UseSqlite(Configuration.GetConnectionString(<span style=color:#0086d2>&#34;MvcMovieContext&#34;</span>)));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=migrations>Migrations
<span><a href=#migrations><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet ef migrations add InitialCreate</code></p><p><code>> dotnet ef database update</code></p><ul><li>Permettent à la base de données d&rsquo;être synchronisée avec les évolutions du Modèle, sans perte de données.</li><li>Migration = évolution incrémentale depuis la migration précédente.</li></ul></section><section><section data-shortcode-section><h3 id=envoi-de-données-aux-vues--viewdata>Envoi de données aux vues : ViewData
<span><a href=#envoi-de-donn%c3%a9es-aux-vues--viewdata><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Approche <em>faiblement typée</em> : on utilie un dictionnaire standard.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> IActionResult Welcome(<span style=color:#cdcaa9;font-weight:700>string</span> name, <span style=color:#cdcaa9;font-weight:700>int</span> numTimes = <span style=color:#0086f7;font-weight:700>1</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    ViewData[<span style=color:#0086d2>&#34;Message&#34;</span>] = <span style=color:#0086d2>&#34;Hello &#34;</span> + name;
</span></span><span style=display:flex><span>    ViewData[<span style=color:#0086d2>&#34;NumTimes&#34;</span>] = numTimes;
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>return</span> View();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=utilisation-dans-la-vue>Utilisation dans la vue
<span><a href=#utilisation-dans-la-vue><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>@{
</span></span><span style=display:flex><span>    ViewData[<span style=color:#0086d2>&#34;Title&#34;</span>] = <span style=color:#0086d2>&#34;Welcome&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>&lt;h2&gt;Welcome&lt;/h2&gt;
</span></span><span style=display:flex><span>&lt;ul&gt;
</span></span><span style=display:flex><span>    @for (<span style=color:#cdcaa9;font-weight:700>int</span> i = <span style=color:#0086f7;font-weight:700>0</span>; i &lt; (<span style=color:#cdcaa9;font-weight:700>int</span>)ViewData[<span style=color:#0086d2>&#34;NumTimes&#34;</span>]; i++)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        &lt;li&gt;@ViewData[<span style=color:#0086d2>&#34;Message&#34;</span>]&lt;/li&gt;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>&lt;/ul&gt;
</span></span></code></pre></div></section></section><section><section data-shortcode-section><h3 id=envoi-de-données-aux-vues--viewmodel>Envoi de données aux vues : ViewModel
<span><a href=#envoi-de-donn%c3%a9es-aux-vues--viewmodel><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Approche <em>fortement typée</em> : on définit une classe pour porter les données de la vue.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Address
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Name { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Street { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> City { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> State { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> PostalCode { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=utilisation-dans-le-contrôleur>Utilisation dans le contrôleur
<span><a href=#utilisation-dans-le-contr%c3%b4leur><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> IActionResult Contact()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#cdcaa9;font-weight:700>var</span> viewModel = <span style=color:#fb660a;font-weight:700>new</span> Address()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        Name = <span style=color:#0086d2>&#34;Microsoft&#34;</span>,
</span></span><span style=display:flex><span>        Street = <span style=color:#0086d2>&#34;One Microsoft Way&#34;</span>,
</span></span><span style=display:flex><span>        City = <span style=color:#0086d2>&#34;Redmond&#34;</span>,
</span></span><span style=display:flex><span>        State = <span style=color:#0086d2>&#34;WA&#34;</span>,
</span></span><span style=display:flex><span>        PostalCode = <span style=color:#0086d2>&#34;98052-6399&#34;</span>
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>return</span> View(viewModel);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=utilisation-dans-la-vue>Utilisation dans la vue
<span><a href=#utilisation-dans-la-vue><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>@model WebApplication1.ViewModels.Address
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#fb660a;font-weight:700>h2</span>&gt;Contact&lt;/<span style=color:#fb660a;font-weight:700>h2</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#fb660a;font-weight:700>address</span>&gt;
</span></span><span style=display:flex><span>  @Model.Street&lt;<span style=color:#fb660a;font-weight:700>br</span> /&gt;
</span></span><span style=display:flex><span>  @Model.City, @Model.State @Model.PostalCode&lt;<span style=color:#fb660a;font-weight:700>br</span> /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#fb660a;font-weight:700>abbr</span> <span style=color:#ff0086;font-weight:700>title</span>=<span style=color:#0086d2>&#34;Phone&#34;</span>&gt;P:&lt;/<span style=color:#fb660a;font-weight:700>abbr</span>&gt; 425.555.0100
</span></span><span style=display:flex><span>&lt;/<span style=color:#fb660a;font-weight:700>address</span>&gt;
</span></span></code></pre></div></section></section><section><section data-shortcode-section><h3 id=view-layout>View layout
<span><a href=#view-layout><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Par défaut, toutes les vues partagent une structure commune définie dans le fichier <code>Views/Shared/_Layout.cshtml</code>.</li><li>Dans ce layout, la fonction <code>@RenderBody()</code> permet de générer le contenu spécifique de la vue à afficher.</li><li>Les éléments spécifiques à une vue (exemples : inclusions CSS ou JavaScript) peuvent être rassemblés dans des <strong>sections</strong> affichées par le layout.</li></ul></section><section><h3 id=exemple-de-layout>Exemple de layout
<span><a href=#exemple-de-layout><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#ff0007;background-color:#0f140f;font-weight:700;font-style:italic>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#fb660a;font-weight:700>html</span> <span style=color:#ff0086;font-weight:700>lang</span>=<span style=color:#0086d2>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#fb660a;font-weight:700>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#fb660a;font-weight:700>meta</span> <span style=color:#ff0086;font-weight:700>charset</span>=<span style=color:#0086d2>&#34;utf-8&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#fb660a;font-weight:700>title</span>&gt;@ViewData[&#34;Title&#34;] - Movie App&lt;/<span style=color:#fb660a;font-weight:700>title</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>&lt;!-- ... --&gt;</span>
</span></span><span style=display:flex><span>  &lt;/<span style=color:#fb660a;font-weight:700>head</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#fb660a;font-weight:700>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#fb660a;font-weight:700>header</span>&gt;<span style=color:#080;background-color:#0f140f;font-style:italic>&lt;!-- ... --&gt;</span>&lt;/<span style=color:#fb660a;font-weight:700>header</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#fb660a;font-weight:700>div</span> <span style=color:#ff0086;font-weight:700>class</span>=<span style=color:#0086d2>&#34;container&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#fb660a;font-weight:700>main</span> <span style=color:#ff0086;font-weight:700>role</span>=<span style=color:#0086d2>&#34;main&#34;</span> <span style=color:#ff0086;font-weight:700>class</span>=<span style=color:#0086d2>&#34;pb-3&#34;</span>&gt;@RenderBody()&lt;/<span style=color:#fb660a;font-weight:700>main</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#fb660a;font-weight:700>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#fb660a;font-weight:700>footer</span>&gt;<span style=color:#080;background-color:#0f140f;font-style:italic>&lt;!-- ... --&gt;</span>&lt;/<span style=color:#fb660a;font-weight:700>footer</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#fb660a;font-weight:700>script</span> <span style=color:#ff0086;font-weight:700>src</span>=<span style=color:#0086d2>&#34;~/lib/jquery/dist/jquery.min.js&#34;</span>&gt;&lt;/<span style=color:#fb660a;font-weight:700>script</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>&lt;!-- ... --&gt;</span>
</span></span><span style=display:flex><span>    @await RenderSectionAsync(&#34;Scripts&#34;, required: false)
</span></span><span style=display:flex><span>  &lt;/<span style=color:#fb660a;font-weight:700>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#fb660a;font-weight:700>html</span>&gt;
</span></span></code></pre></div></section></section><section><section data-shortcode-section><h3 id=validation-des-données>Validation des données
<span><a href=#validation-des-donn%c3%a9es><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>L&rsquo;annotation des classes du Modèle permet de définir des <strong>règles de validation</strong> qui seront automatiquement vérifiées à la fois côté serveur et côté client.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> System.ComponentModel.DataAnnotations;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> LoginViewModel
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Required]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [EmailAddress]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Email { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>
</span></span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Required]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [DataType(DataType.Password)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Password { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>
</span></span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Display(Name = &#34;Remember me?&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>bool</span> RememberMe { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=validation-dans-le-contrôleur>Validation dans le contrôleur
<span><a href=#validation-dans-le-contr%c3%b4leur><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task&lt;IActionResult&gt; Login(LoginViewModel model, <span style=color:#cdcaa9;font-weight:700>string</span> returnUrl = <span style=color:#fb660a;font-weight:700>null</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// Check model validation rules</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>if</span> (ModelState.IsValid)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#080;background-color:#0f140f;font-style:italic>// ... (nominal case: work with the model)</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// At this point, something failed: redisplay form</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>return</span> View(model);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section></section><section><section data-shortcode-section><h3 id=environnements>Environnements
<span><a href=#environnements><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Permettent d&rsquo;adapter la configuration de l&rsquo;application au contexte (développement, test ou production).</li><li>Définis par la variable d&rsquo;environnement <code>ASPNETCORE_ENVIRONMENT</code>. En l&rsquo;absence de cette variable, l&rsquo;environnement est de type Production.</li><li><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-5.0">Plus d&rsquo;informations</a>.</li></ul></section><section><h3 id=définition-de-lenvironnement-avec-visual-studio-code>Définition de l&rsquo;environnement avec Visual Studio Code
<span><a href=#d%c3%a9finition-de-lenvironnement-avec-visual-studio-code><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Fichier <code>./vscode/launch.json</code></p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#fb660a;font-weight:700>&#34;version&#34;</span>: <span style=color:#0086d2>&#34;0.2.0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#fb660a;font-weight:700>&#34;configurations&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;name&#34;</span>: <span style=color:#0086d2>&#34;.NET Core Launch (web)&#34;</span>,
</span></span><span style=display:flex><span>      # ...
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;env&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>&#34;ASPNETCORE_ENVIRONMENT&#34;</span>: <span style=color:#0086d2>&#34;Development&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      # ...
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=configuration-de-lapplication-selon-lenvironnement-détecté>Configuration de l&rsquo;application selon l&rsquo;environnement détecté
<span><a href=#configuration-de-lapplication-selon-lenvironnement-d%c3%a9tect%c3%a9><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>if</span> (env.IsDevelopment())
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        app.UseDeveloperExceptionPage();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>if</span> (env.IsProduction() || env.IsStaging())
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        app.UseExceptionHandler(<span style=color:#0086d2>&#34;/Error&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span></code></pre></div></section></section><section><h2 id=création-dapi-web>Création d&rsquo;API web
<span><a href=#cr%c3%a9ation-dapi-web><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><h3 id=la-notion-dapi>La notion d&rsquo;API
<span><a href=#la-notion-dapi><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Une <strong>API</strong> (<em>Application Programming Interface</em>) est un point d&rsquo;entrée programmatique dans un système.</p><p>Elle fournit un moyen d&rsquo;interagir avec ce système.</p><p>Les API permettent aux développeurs d&rsquo;intégrer des services externes dans leurs applications.</p></section><section><h3 id=spécificités-des-api-web>Spécificités des API web
<span><a href=#sp%c3%a9cificit%c3%a9s-des-api-web><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Une <strong>API web</strong> (appelée parfois service web) est une API accessible via les technologies du web : HTTP ou HTTPS.</p><p>Les API web utilisent le plus souvent le format de donnée <strong>JSON</strong>.</p><p>Certaines sont librement utilisables, d&rsquo;autres nécessitent une authentification du client.</p></section><section><h3 id=exemples-dapi-web>Exemples d&rsquo;API web
<span><a href=#exemples-dapi-web><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><a href=https://pokeapi.co/>PokéAPI</a></li><li><a href=https://swapi.dev/>Star Wars API</a></li><li><a href=https://en.wikipedia.org/w/api.php?>Wikipedia</a></li><li><a href=https://developer.spotify.com/documentation/web-api/>Spotify</a></li><li><a href=https://www.omdbapi.com/>OMDb API</a></li></ul><p>(<a href=https://shkspr.mobi/blog/2016/05/easy-apis-without-authentication/>Source</a>)</p></section><section><h3 id=outils-pour-la-gestion-des-api-web>Outils pour la gestion des API web
<span><a href=#outils-pour-la-gestion-des-api-web><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>N&rsquo;importe quel navigateur pour les tests basiques.</li><li>Extension <a href=https://addons.mozilla.org/fr/firefox/addon/restclient/>RESTClient</a> pour Firefox.</li><li><a href=https://www.getpostman.com/>Postman</a>.</li></ul></section><section><h3 id=les-api-restful>Les API RESTful
<span><a href=#les-api-restful><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><strong>REST</strong> (<em>REpresentational State Transfer</em>) est un ensemble de principes pour créer des API : client/serveur, pas de gestion d&rsquo;état, etc.</li><li>Une API web <em>RESTful</em> (conforme au standard REST) expose une interface basée sur les commandes HTTP. Exemples :<ul><li><code>GET /&lt;ResourceName>/&lt;id></code> pour accéder à une ressource.</li><li><code>POST /&lt;ResourceName></code> (avec les informations nécessaires dans le corps de la requête) pour la créer.</li></ul></li></ul></section><section><section data-shortcode-section><h3 id=le-format-json>Le format JSON
<span><a href=#le-format-json><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>JSON = JavaScript Object Notation.</li><li>Format de description de données structurées inspiré de la syntaxe des objets JavaScript.</li><li>Contenu JSON = ensemble de paires champ/valeur.</li><li>Types de valeur possibles : nombres, chaînes, booléens, tableaux, objets.</li><li>A supplanté XML comme format standard pour les échanges de données via des API web.</li></ul></section><section><h3 id=exemple-de-contenu-json>Exemple de contenu JSON
<span><a href=#exemple-de-contenu-json><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#fb660a;font-weight:700>&#34;cars&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;model&#34;</span>: <span style=color:#0086d2>&#34;Peugeot&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;color&#34;</span>: <span style=color:#0086d2>&#34;blue&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;checkups&#34;</span>: [<span style=color:#0086f7;font-weight:700>2015</span>, <span style=color:#0086f7;font-weight:700>2017</span>]
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;model&#34;</span>: <span style=color:#0086d2>&#34;Citroën&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;color&#34;</span>: <span style=color:#0086d2>&#34;white&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;checkups&#34;</span>: [<span style=color:#0086f7;font-weight:700>2003</span>, <span style=color:#0086f7;font-weight:700>2005</span>, <span style=color:#0086f7;font-weight:700>2007</span>, <span style=color:#0086f7;font-weight:700>2009</span>, <span style=color:#0086f7;font-weight:700>2011</span>, <span style=color:#0086f7;font-weight:700>2013</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section></section><section><h3 id=création-dune-api-web-avec-aspnet-core>Création d&rsquo;une API web avec ASP.NET Core
<span><a href=#cr%c3%a9ation-dune-api-web-avec-aspnet-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet-aspnet-codegenerator controller -name &lt;ControllerName> -m &lt;ModelName> -async -api [other arguments]</code></p><p>Crée un contrôleur <code>&lt;ControllerName></code> qui :</p><ul><li>expose une API web pour la classe <code>&lt;ModelName></code> du Modèle ;</li><li>renvoie des données au format JSON et non des vues HTML.</li></ul></section><section><h3 id=principe-de-fonctionnement>Principe de fonctionnement
<span><a href=#principe-de-fonctionnement><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><img src=images/aspnetcore_api.png alt="API call with ASP.NET Core"></p></section><section><h3 id=exemple-de-contrôleur-dapi>Exemple de contrôleur d&rsquo;API
<span><a href=#exemple-de-contr%c3%b4leur-dapi><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#ff0086;font-weight:700>[Route(&#34;api/[controller]</span><span style=color:#0086d2>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span><span style=color:#ff0086;font-weight:700>[ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> TodosApiController : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Hérite de la classe <code>ControllerBase</code> et non pas de <code>Controller</code> comme les contrôleurs &ldquo;classiques&rdquo;.</li><li>Associé aux routes du type <code>api/TodosApi/&lt;Argument?></code>.</li></ul></section><section><h3 id=api-générée>API générée
<span><a href=#api-g%c3%a9n%c3%a9r%c3%a9e><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><table><thead><tr><th>Route</th><th>Description</th></tr></thead><tbody><tr><td>GET /api/TodosApi</td><td>Renvoie tous les éléments</td></tr><tr><td>GET /api/TodosApi/{id}</td><td>Renvoie un élément</td></tr><tr><td>POST /api/TodosApi</td><td>Ajoute un nouvel élément</td></tr><tr><td>PUT /api/TodosApi/{id}</td><td>Met à jour un élément</td></tr><tr><td>DELETE /api/TodosApi/{id}</td><td>Supprime un élément</td></tr></tbody></table></section><section><h3 id=exemple-de-méthode-dapi>Exemple de méthode d&rsquo;API
<span><a href=#exemple-de-m%c3%a9thode-dapi><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// GET: api/TodosApi/5</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>[HttpGet(&#34;{id}&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task&lt;ActionResult&lt;Todo&gt;&gt; GetTodo(<span style=color:#cdcaa9;font-weight:700>int</span> id)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#cdcaa9;font-weight:700>var</span> todo = <span style=color:#fb660a;font-weight:700>await</span> <span style=color:#0086f7;font-weight:700>_</span>context.Todo.FindAsync(id);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>if</span> (todo == <span style=color:#fb660a;font-weight:700>null</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>return</span> NotFound();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>return</span> todo;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><section data-shortcode-section><h3 id=programmation-asynchrone>Programmation asynchrone
<span><a href=#programmation-asynchrone><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><p>Exemple : la préparation d&rsquo;un petit déjeuner.</p><ol><li>Verser le café dans une tasse.</li><li>Faire chauffer la poêle, puis faire cuire deux œufs au plat.</li><li>Faire frire trois tranches de bacon.</li><li>Faire toaster deux tranches de pain.</li><li>Étaler le beurre et la confiture sur les toasts.</li><li>Verser du jus d’orange dans un verre.</li></ol></li><li><p>La plupart de ces tâches peuvent être exécutées simultanément.</p></li></ul></section><section><h3 id=exécution-séquentielle-synchrone>Exécution séquentielle (synchrone)
<span><a href=#ex%c3%a9cution-s%c3%a9quentielle-synchrone><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><a href=https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/><img src=images/synchronous-breakfast.png alt="Synchronous breakfast"></a></p></section><section><h3 id=exécution-asynchrone>Exécution asynchrone
<span><a href=#ex%c3%a9cution-asynchrone><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><a href=https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/><img src=images/async-breakfast.png alt="Asynchronous breakfast"></a></p></section></section><section><h3 id=appels-synchrones>Appels synchrones
<span><a href=#appels-synchrones><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><a href=https://code-maze.com/asynchronous-programming-with-async-and-await-in-asp-net-core/><img src=images/sync-request-asp.net-core.png alt="Synchronous requests"></a></p></section><section><h3 id=appels-asynchrones>Appels asynchrones
<span><a href=#appels-asynchrones><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><a href=https://code-maze.com/asynchronous-programming-with-async-and-await-in-asp-net-core/><img src=images/async-request-asp.net-core.png alt="Asynchronous requests"></a></p></section><section><h2 id=interactions-avec-une-base-de-données>Interactions avec une base de données
<span><a href=#interactions-avec-une-base-de-donn%c3%a9es><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><h3 id=les-données-persistantes>Les données persistantes
<span><a href=#les-donn%c3%a9es-persistantes><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Ne disparaissent pas entre deux utilisations d&rsquo;une application.</li><li>Contraire : données <em>volatiles</em>.</li><li>Indispensable pour une très grande majorité des applications (données métier, configuration, etc).</li><li>Leur stockage nécessite :<ul><li>un support dédié, appelé parfois mémoire de masse (disque dur/SSD, mémoire Flash, etc) ;</li><li>un format adapté.</li></ul></li></ul></section><section><h3 id=les-sgbdr-et-leurs-avantages>Les SGBDR et leurs avantages
<span><a href=#les-sgbdr-et-leurs-avantages><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Standard actuel pour la gestion de données persistantes.</li><li>Technologie connue depuis les années 1970.</li><li>Fiabilité.</li><li>Capacité à gérer de forts volumes de données.</li><li>Sécurité (authentification, réplication, etc).</li><li>Langage d’interrogation (SQL) standard.</li><li>Offre logicielle riche : de ORACLE à SQLite en passant par PostgreSQL, MySQL/MariaDB ou SQL Server.</li></ul></section><section><h3 id=le-modèle-relationnel>Le modèle relationnel
<span><a href=#le-mod%c3%a8le-relationnel><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Unité de représentation : table.</li><li>Caractéristiques : colonnes.</li><li>Entité : tuple (ligne).</li><li>Types de données : simples (nombres, chaîne, date, etc).</li><li>Identifiant : explicite (clé primaire).</li><li>Relations entre éléments : jointures SQL.</li><li>Concepts spécifiques : déclencheurs, procédures stockées&mldr;</li></ul></section><section><h3 id=le-modèle-objet>Le modèle objet
<span><a href=#le-mod%c3%a8le-objet><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Unité de représentation : classe.</li><li>Caractéristiques : propriétés et méthodes.</li><li>Entité : objet.</li><li>Types de données : simples ou complexes.</li><li>Identifiant : implicite (référence mémoire).</li><li>Relations entre éléments : navigation des associations.</li><li>Concepts spécifiques : encapsulation, héritage, interfaces&mldr;</li></ul></section><section><section data-shortcode-section><h3 id=objectrelational-mapping-orm>Object/Relational Mapping (O/RM)
<span><a href=#objectrelational-mapping-orm><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Lien entre une base de données et les objets manipulés par l’application.</li><li>Deux modèles très éloignés ("<a href=https://en.wikipedia.org/wiki/Object%E2%80%93relational_impedance_mismatch>impedance mismatch</a>").</li><li>Pas de solution idéale.</li></ul></section><section><h3 id=orm-is-the-vietnam-of-computer-sciencehttpsblogcodinghorrorcomobject-relational-mapping-is-the-vietnam-of-computer-science><a href=https://blog.codinghorror.com/object-relational-mapping-is-the-vietnam-of-computer-science/>&ldquo;O/RM is the Vietnam of Computer Science&rdquo;</a>
<span><a href=#orm-is-the-vietnam-of-computer-sciencehttpsblogcodinghorrorcomobject-relational-mapping-is-the-vietnam-of-computer-science><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><img src=images/orm_vietnam.png alt="Welcome to the jungle!"></p></section></section><section><h3 id=solutions-possibles-pour-lorm>Solutions possibles pour l&rsquo;O/RM
<span><a href=#solutions-possibles-pour-lorm><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Approches radicales : suppression du SGBDR (utilisation d&rsquo;une autre technologie de stockage) ou des objets (programmation procédurale ou fonctionnelle).</li><li>O/RM manuel : gestion de la (dé)connexion, requêtage avec SQL puis transformation des résultats en objets, etc doivent être codées.</li><li>O/RM automatisé : utilisation d&rsquo;un outil dédié pour gérer les problématiques précédentes. Le requêtage SQL est effectué par l&rsquo;outil.</li></ul></section><section><h3 id=orm-automatisé-un-bon-choix->O/RM automatisé, un bon choix ?
<span><a href=#orm-automatis%c3%a9-un-bon-choix-><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Avantages :<ul><li>Automatisation de la gestion du <em>mapping</em>.</li><li>Diminution du volume de code.</li><li>Mise en œuvre de bonnes pratiques.</li><li>Performances (le plus souvent).</li></ul></li><li>Inconvénients :<ul><li>Nécessité de maitriser un outil dédié.</li><li>Certaines limitations liées à l’outil.</li><li>Aspect &ldquo;boîte noire&rdquo;.</li><li>Performances (dans certains cas).</li></ul></li></ul></section><section><h3 id=entity-framework-core>Entity Framework Core
<span><a href=#entity-framework-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Outil d&rsquo;O/RM <a href=https://github.com/dotnet/efcore>open source</a> maintenu par Microsoft.</li><li>Supporte de nombreux SGDBR : SQL Server, SQLite, MySQL/MariaDB, PostgreSQL, etc.</li><li>Standard pour l&rsquo;accès aux données persistantes dans l&rsquo;environnement ASP.NET Core.</li></ul></section><section><h3 id=sqlite>SQLite
<span><a href=#sqlite><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>SGBDR minimaliste mais suffisamment fiable, complet et performant pour la plupart des usages standards.</li><li>Toute la base de données tient dans un seul fichier de quelques dizaines/centaines de Ko.</li><li><a href=https://sqlite.org/mostdeployed.html>&ldquo;Le SGBD le plus utilisé dans le monde&rdquo;</a>.</li></ul><p><a href=https://sqlite.org><img src=images/sqlite370_banner.gif alt="SQLite logo"></a></p></section><section><h3 id=installation-def-core-pour-sqlite>Installation d&rsquo;EF Core pour SQLite
<span><a href=#installation-def-core-pour-sqlite><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet tool install --global dotnet-ef</code></p><p><code>> dotnet add package Microsoft.EntityFrameworkCore.Design</code></p><p><code>> dotnet add package Microsoft.EntityFrameworkCore.Sqlite</code></p></section><section><h3 id=support-de-sqlite-par-ef-core>Support de SQLite par EF Core
<span><a href=#support-de-sqlite-par-ef-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Des <a href="https://docs.microsoft.com/en-us/ef/core/providers/?tabs=dotnet-core-cli">fournisseurs de données</a> permettent l&rsquo;utilisation de EF Core avec un grand nombre de sources de données, dont SQLite.</li><li>Son fournisseur possède cependant certaines petites <a href=https://docs.microsoft.com/en-us/ef/core/providers/sqlite/limitations>limitations</a>.</li></ul></section><section><h3 id=principe-de-fonctionnement-def-core>Principe de fonctionnement d&rsquo;EF Core
<span><a href=#principe-de-fonctionnement-def-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><strong>Modèle</strong> : un ensemble de classes POCO, parfois appelées <em>classes métier</em>, qui modélisent les entités manipulées par l&rsquo;application.</li><li><strong>Contexte BD</strong> : une classe qui représente une session d&rsquo;échange avec une base de données (<em>unité de travail</em>) et permet les opérations de lecture/écriture de données. Elle spécifie les classes du modèle à sauvegarder dans la base de données.</li></ul></section><section><h3 id=exemple-de-modèle>Exemple de modèle
<span><a href=#exemple-de-mod%c3%a8le><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><img src=images/efcore_blog_uml.png alt="Exemple de modèle EF Core"></p></section><section><h3 id=implémentation-du-modèle>Implémentation du modèle
<span><a href=#impl%c3%a9mentation-du-mod%c3%a8le><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Blog
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> Id { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Url { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> ICollection&lt;Post&gt; Posts { <span style=color:#fb660a;font-weight:700>get</span>; } = <span style=color:#fb660a;font-weight:700>new</span> List&lt;Post&gt;();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Post
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> Id { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Title { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Content { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> BlogId { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> Blog Blog { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=exemple-de-contexte-bd>Exemple de contexte BD
<span><a href=#exemple-de-contexte-bd><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> BloggingContext : DbContext
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> DbSet&lt;Blog&gt; Blogs { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> DbSet&lt;Post&gt; Posts { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> DbPath { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>private</span> <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> BloggingContext()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        DbPath = <span style=color:#0086d2>&#34;EFGetStarted.db&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>protected</span> <span style=color:#fb660a;font-weight:700>override</span> <span style=color:#fb660a;font-weight:700>void</span> OnConfiguring(DbContextOptionsBuilder options)
</span></span><span style=display:flex><span>        =&gt; options.UseSqlite(<span style=color:#0086d2>$&#34;Data Source={DbPath}&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=migrations-1>Migrations
<span><a href=#migrations-1><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Approche <em><strong>code first</strong></em> : le modèle objet constitue la modélisation de référence. La base de données est automatiquement synchronisée avec lui.</li><li><a href="https://docs.microsoft.com/en-us/ef/core/managing-schemas/migrations/?tabs=dotnet-core-cli">Migrations</a> : modifications incrémentales du schéma relationnel reflétant les évolutions du modèle.</li></ul></section><section><h3 id=commandes-liées-aux-migrations>Commandes liées aux migrations
<span><a href=#commandes-li%c3%a9es-aux-migrations><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet ef migrations add &lt;MigrationName></code></p><p>Crée une nouvelle migration dans le répertoire <strong>Migrations/</strong> du projet. Elle contient les mises à jour à réaliser au niveau du schéma relationnel pour le synchroniser avec le modèle objet.</p><p><code>> dotnet ef database update</code></p><p>Synchronise la base de données configurée par le contexte BD avec la migration la plus récente.</p></section><section><h3 id=exemple-extrait-dune-migration>Exemple extrait d&rsquo;une migration
<span><a href=#exemple-extrait-dune-migration><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>migrationBuilder.CreateTable(
</span></span><span style=display:flex><span>    name: <span style=color:#0086d2>&#34;Blogs&#34;</span>,
</span></span><span style=display:flex><span>    columns: table =&gt; <span style=color:#fb660a;font-weight:700>new</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        Id = table.Column&lt;<span style=color:#cdcaa9;font-weight:700>int</span>&gt;(type: <span style=color:#0086d2>&#34;INTEGER&#34;</span>, nullable: <span style=color:#fb660a;font-weight:700>false</span>)
</span></span><span style=display:flex><span>            .Annotation(<span style=color:#0086d2>&#34;Sqlite:Autoincrement&#34;</span>, <span style=color:#fb660a;font-weight:700>true</span>),
</span></span><span style=display:flex><span>        Url = table.Column&lt;<span style=color:#cdcaa9;font-weight:700>string</span>&gt;(type: <span style=color:#0086d2>&#34;TEXT&#34;</span>, nullable: <span style=color:#fb660a;font-weight:700>true</span>)
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    constraints: table =&gt;
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        table.PrimaryKey(<span style=color:#0086d2>&#34;PK_Blogs&#34;</span>, x =&gt; x.Id);
</span></span><span style=display:flex><span>    });
</span></span></code></pre></div></section><section><h3 id=résultat-de-la-mise-à-jour-bd>Résultat de la mise à jour BD
<span><a href=#r%c3%a9sultat-de-la-mise-%c3%a0-jour-bd><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><img src=images/efcore_blog_schema.png alt="Schéma BD généré par EF Core"></p><p>(Capture d&rsquo;écran de <a href=https://sqlitebrowser.org/>DB Browser pour SQLite</a>).</p><p>La colonne <code>BlogId</code> est une clé étrangère vers la colonne <code>Id</code> de la table <code>Blog</code>.</p></section><section><h3 id=opérations-crud>Opérations CRUD
<span><a href=#op%c3%a9rations-crud><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> (<span style=color:#cdcaa9;font-weight:700>var</span> context = <span style=color:#fb660a;font-weight:700>new</span> BloggingContext())
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    context.Add(<span style=color:#fb660a;font-weight:700>new</span> Blog { Url = <span style=color:#0086d2>&#34;http://blogs.msdn.com/adonet&#34;</span> });
</span></span><span style=display:flex><span>    context.SaveChanges();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// Retrieve blog with lowest id</span>
</span></span><span style=display:flex><span>    <span style=color:#cdcaa9;font-weight:700>var</span> blog = context.Blogs
</span></span><span style=display:flex><span>        .OrderBy(b =&gt; b.Id)
</span></span><span style=display:flex><span>        .First();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    blog.Url = <span style=color:#0086d2>&#34;https://devblogs.microsoft.com/dotnet&#34;</span>;
</span></span><span style=display:flex><span>    blog.Posts.Add(
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>new</span> Post { Title = <span style=color:#0086d2>&#34;Hello World&#34;</span>, Content = <span style=color:#0086d2>&#34;I wrote an app using EF Core!&#34;</span> });
</span></span><span style=display:flex><span>    context.SaveChanges();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    context.Remove(blog);
</span></span><span style=display:flex><span>    context.SaveChanges();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><section data-shortcode-section><h3 id=requêtage-avec-linq>Requêtage avec LINQ
<span><a href=#requ%c3%aatage-avec-linq><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><a href=https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/linq/>Language Integrated Query (LINQ)</a> est le langage standard pour le requêtage en C#, quelle que soit la source de données (SGBDR, XML, service web, etc).</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> (<span style=color:#cdcaa9;font-weight:700>var</span> context = <span style=color:#fb660a;font-weight:700>new</span> BloggingContext())
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// Retrieve a list of blogs with a rating greater than 3,</span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ordered by URL</span>
</span></span><span style=display:flex><span>    <span style=color:#cdcaa9;font-weight:700>var</span> blogs = context.Blogs
</span></span><span style=display:flex><span>        .Where(b =&gt; b.Rating &gt; <span style=color:#0086f7;font-weight:700>3</span>)
</span></span><span style=display:flex><span>        .OrderBy(b =&gt; b.Url)
</span></span><span style=display:flex><span>        .ToList();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=exemples-dutilisation-de-linq>Exemples d&rsquo;utilisation de LINQ
<span><a href=#exemples-dutilisation-de-linq><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> (<span style=color:#cdcaa9;font-weight:700>var</span> context = <span style=color:#fb660a;font-weight:700>new</span> BloggingContext())
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// Get all blogs</span>
</span></span><span style=display:flex><span>    <span style=color:#cdcaa9;font-weight:700>var</span> blogs = context.Blogs.ToList();
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// Get a specific blog</span>
</span></span><span style=display:flex><span>    <span style=color:#cdcaa9;font-weight:700>var</span> blog = context.Blogs
</span></span><span style=display:flex><span>        .Single(b =&gt; b.Id == <span style=color:#0086f7;font-weight:700>1</span>);
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// Get all blogs containing &#34;dotnet&#34; in their URL</span>
</span></span><span style=display:flex><span>    <span style=color:#cdcaa9;font-weight:700>var</span> blogs = context.Blogs
</span></span><span style=display:flex><span>        .Where(b =&gt; b.Url.Contains(<span style=color:#0086d2>&#34;dotnet&#34;</span>))
</span></span><span style=display:flex><span>        .ToList();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>(<a href=https://docs.microsoft.com/en-us/ef/core/querying/>Plus de détails</a>)</p></section><section><h3 id=syntaxe-alternative-pour-linq>Syntaxe alternative pour LINQ
<span><a href=#syntaxe-alternative-pour-linq><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Pour plus de souplesse, il est possible de manipuler des requêtes LINQ en tant que variables.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> (<span style=color:#cdcaa9;font-weight:700>var</span> context = <span style=color:#fb660a;font-weight:700>new</span> BloggingContext())
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// Get all blogs containing &#34;dotnet&#34; in their URL</span>
</span></span><span style=display:flex><span>    <span style=color:#cdcaa9;font-weight:700>var</span> query = <span style=color:#fb660a;font-weight:700>from</span> b <span style=color:#fb660a;font-weight:700>in</span> context.Blogs
</span></span><span style=display:flex><span>                <span style=color:#fb660a;font-weight:700>select</span> b;
</span></span><span style=display:flex><span>    query = query.Where(b =&gt; b.Url.Contains(<span style=color:#0086d2>&#34;dotnet&#34;</span>));
</span></span><span style=display:flex><span>    <span style=color:#cdcaa9;font-weight:700>var</span> blogs = query.ToList();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section></section><section><h3 id=sauvegarde-des-modifications>Sauvegarde des modifications
<span><a href=#sauvegarde-des-modifications><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>La méthode <code>SaveChanges()</code> de la classe <code>DbContext</code> implante dans la base de données tous les changements ayant eu lieu depuis l&rsquo;ouverture de la session liée au contexte BD.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> (<span style=color:#cdcaa9;font-weight:700>var</span> context = <span style=color:#fb660a;font-weight:700>new</span> BloggingContext())
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#cdcaa9;font-weight:700>var</span> blog = <span style=color:#fb660a;font-weight:700>new</span> Blog { Url = <span style=color:#0086d2>&#34;http://sample.com&#34;</span> };
</span></span><span style=display:flex><span>    context.Blogs.Add(blog);
</span></span><span style=display:flex><span>    context.SaveChanges();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=configuration-du-modèle>Configuration du modèle
<span><a href=#configuration-du-mod%c3%a8le><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Effectuée via des <a href="https://docs.microsoft.com/en-us/ef/core/modeling/entity-properties?tabs=data-annotations%2Cwithout-nrt">annotations</a> dans les classes du modèle.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Blog
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> Id { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>
</span></span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [StringLength(200, MinimumLength = 7), Required]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Url { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>
</span></span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Display(Name = &#34;Average Rating&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Column(TypeName = &#34;decimal(5, 2)&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [DisplayFormat(NullDisplayText = &#34;No rating&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>decimal?</span> Rating { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span></code></pre></div></section><section><h3 id=propriétés-obligatoires-et-optionnelles>Propriétés obligatoires et optionnelles
<span><a href=#propri%c3%a9t%c3%a9s-obligatoires-et-optionnelles><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Une propriété est considérée comme optionnelle si elle peut contenir <code>null</code>. La colonne BD associée accepte les valeurs nulles.</li><li>L&rsquo;attribut <code>[Required]</code> permet de rendre obligatoire une propriété ayant un type référence (exemple : <code>string</code>).</li><li>L&rsquo;utilisation d&rsquo;un <a href=https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/nullable-value-types>type nullable</a> (exemples : <code>int?</code>, `bool?) rend la propriété optionnelle.</li></ul></section><section><h3 id=clés-primaires>Clés primaires
<span><a href=#cl%c3%a9s-primaires><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Une propriété nommée <code>Id</code> ou <code>&lt;Classe>Id</code> est considérée comme clé primaire.</li><li>Par défaut, une stratégie d&rsquo;<a href="https://docs.microsoft.com/en-us/ef/core/modeling/generated-properties?tabs=data-annotations">auto-génération des valeurs</a> est utilisée.</li><li><a href="https://docs.microsoft.com/en-us/ef/core/modeling/keys?tabs=data-annotations">Plus de détails</a>.</li></ul></section><section><section data-shortcode-section><h3 id=relations-entre-classes>Relations entre classes
<span><a href=#relations-entre-classes><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Une propriété utilisant un type autre que scalaire est dite <strong>propriété de navigation</strong>.</li><li>La détection d&rsquo;une propriété de navigation entraine la création d&rsquo;une <strong>relation</strong> entre les deux classes impliquées.</li><li>Cette relation se traduit dans la base de données par la création d&rsquo;une <strong>clé étrangère</strong> dans la table associée à la classe dépendante (fille) de la relation.</li></ul></section><section><h3 id=relation-un-à-plusieurs>Relation un-à-plusieurs
<span><a href=#relation-un-%c3%a0-plusieurs><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Propriété de navigation de type collection dans la classe principale (mère).</li><li>Propriété de navigation et d&rsquo;une propriété de clé étrangère dans la classe dépendante (fille).</li></ul><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Blog
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> Id { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> List&lt;Post&gt; Posts { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Post
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> Id { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> BlogId { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> Blog Blog { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=relation-un-à-un>Relation un-à-un
<span><a href=#relation-un-%c3%a0-un><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Blog
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> Id { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> BlogImage BlogImage { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> BlogImage
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> Id { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>byte</span>[] Image { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Caption { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> BlogId { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> Blog Blog { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=relation-plusieurs-à-plusieurs>Relation plusieurs-à-plusieurs
<span><a href=#relation-plusieurs-%c3%a0-plusieurs><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Entraîne la création d&rsquo;une table de jointure contenant deux clés étrangères dans la base de données.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Post
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> Id { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> ICollection&lt;Tag&gt; Tags { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Tag
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Id { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> ICollection&lt;Post&gt; Posts { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section></section><section><h3 id=chargement-des-relations>Chargement des relations
<span><a href=#chargement-des-relations><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Les méthodes <code>.Include()</code> et <code>.ThenInclude()</code> permettent de spécifier les données associées à inclure dans les résultats d&rsquo;une requête.</li><li>Ce mécanisme est appelé <a href=https://docs.microsoft.com/en-us/ef/core/querying/related-data/eager>chargement hâtif</a> (<em>eager loading</em>).</li></ul><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> (<span style=color:#cdcaa9;font-weight:700>var</span> context = <span style=color:#fb660a;font-weight:700>new</span> BloggingContext())
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// Load posts for each blog</span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// Uncomment the .ThenInclude line to load post author</span>
</span></span><span style=display:flex><span>    <span style=color:#cdcaa9;font-weight:700>var</span> blogs = context.Blogs
</span></span><span style=display:flex><span>        .Include(blog =&gt; blog.Posts)
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// .ThenInclude(post =&gt; post.Author)</span>
</span></span><span style=display:flex><span>        .ToList();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=ef-core-et-aspnet-core>EF Core et ASP.NET Core
<span><a href=#ef-core-et-aspnet-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Un contexte BD est <a href=https://docs.microsoft.com/en-us/ef/core/dbcontext-configuration/>associé</a> à chaque requête HTTP entrante dans le fichier <code>Startup.cs</code>.</li><li>Il est ensuite utilisé par les contrôleurs pour interagir avec la base de données.</li></ul><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Startup
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>//...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> ConfigureServices(IServiceCollection services)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        services.AddControllersWithViews();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        services.AddDbContext&lt;MvcMovieContext&gt;(options =&gt;
</span></span><span style=display:flex><span>                options.UseSqlite(Configuration.GetConnectionString(<span style=color:#0086d2>&#34;MvcMovieContext&#34;</span>)));
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div></section><section><h3 id=affichage-des-requêtes-sql-exécutées-par-ef-core>Affichage des requêtes SQL exécutées par EF Core
<span><a href=#affichage-des-requ%c3%aates-sql-ex%c3%a9cut%c3%a9es-par-ef-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Ajout de la ligne ci-dessous dans le fichier <code>appsettings.json</code>.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#fb660a;font-weight:700>&#34;Logging&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>&#34;LogLevel&#34;</span>: {
</span></span><span style=display:flex><span>      # ...
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;Microsoft.EntityFrameworkCore.Database.Command&#34;</span>: <span style=color:#0086d2>&#34;Information&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  # ...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h2 id=tests>Tests
<span><a href=#tests><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><h3 id=typologie-des-tests>Typologie des tests
<span><a href=#typologie-des-tests><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><strong>Test unitaire</strong> (TU) : vérifie un composant individuel de l&rsquo;application.</li><li><strong>Test d&rsquo;intégration</strong> : vérifie les interactions entre différents composants de l&rsquo;application, y compris des composants externes comme une base de données ou un service web.</li><li><strong>Test fonctionnel (ou test de validation)</strong> : vérifie que l&rsquo;application fonctionne comme prévu du point de vue de l&rsquo;utilisateur.</li></ul></section><section><h3 id=tests-unitaires-vs-tests-dintégration>Tests unitaires Vs tests d&rsquo;intégration
<span><a href=#tests-unitaires-vs-tests-dint%c3%a9gration><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Ils sont tous deux automatisés.</li><li>Les TU isolent le composant à tester du reste de l&rsquo;application à l&rsquo;aide de <em>test doubles</em> (parfois appelés <em>dummies</em>, <em>stubs</em> ou encore <em>mocks</em>) qui simulent le comportement des autres composants. Leur exécution est rapide.</li><li>Les tests d&rsquo;intégration se basent sur les véritables composants de l&rsquo;application. Leur mise en place est souvent plus complexe et leur exécution plus lente.</li></ul></section><section><h3 id=quelle-stratégie-adopter->Quelle stratégie adopter ?
<span><a href=#quelle-strat%c3%a9gie-adopter-><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Vouloir tester tous les scénarios et configurations possibles est coûteux et pas forcément efficace.</li><li>Il est préférable de se concentrer sur les éléments-clés offrant le meilleur rapport coût/bénéfices : composants essentiels, opérations élémentaires (CRUD), principaux services de l&rsquo;application&mldr;</li><li>Des <em>smoke tests</em> vérifiant uniquement le renvoi d&rsquo;un code HTTP de succès pour chaque route peuvent constituer un premier filet de sécurité.</li></ul></section><section><h3 id=etapes-dun-test--le-patron-aaa>Etapes d&rsquo;un test : le patron AAA
<span><a href=#etapes-dun-test--le-patron-aaa><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><em>Arrange</em> : préparation du test.<ul><li>Lancement de l&rsquo;application ;</li><li>Préparation de la base de données ;</li><li>&mldr;</li></ul></li><li><em>Act</em> : réalisation des opérations à tester.</li><li><em>Assert</em> : vérification des résultats des actions précédentes au moyen d&rsquo;<a href=https://en.wikipedia.org/wiki/Assertion_(software_development)>assertions</a>.</li></ul></section><section><h3 id=création-dun-projet-de-test-net>Création d&rsquo;un projet de test .NET
<span><a href=#cr%c3%a9ation-dun-projet-de-test-net><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet new xunit -o &lt;TestProjectName></code></p><p><a href=https://xunit.net/>xUnit</a> est un framework de tests unitaires <em>open source</em> pour la plate-forme .NET.</p><p><code>> dotnet add ./&lt;TestProjectName>/&lt;TestProjectName>.csproj reference ./&lt;ProjectName>/&lt;ProjectName>.csproj</code></p><p>Ajoute au projet de test une référence vers le projet à tester (les deux étant situés dans le même répertoire parent).</p></section><section><h3 id=exemple-de-classe-de-test>Exemple de classe de test
<span><a href=#exemple-de-classe-de-test><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>[Fact]</code> indique une méthode de test.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> Xunit;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>namespace</span> Prime.UnitTests.Services
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> PrimeService_IsPrimeShould
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>        [Fact]</span>
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> IsPrime_InputIs1_ReturnFalse()
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#080;background-color:#0f140f;font-style:italic>// Arrange</span>
</span></span><span style=display:flex><span>            <span style=color:#cdcaa9;font-weight:700>var</span> primeService = <span style=color:#fb660a;font-weight:700>new</span> PrimeService();
</span></span><span style=display:flex><span>            <span style=color:#080;background-color:#0f140f;font-style:italic>// Act</span>
</span></span><span style=display:flex><span>            <span style=color:#cdcaa9;font-weight:700>bool</span> result = primeService.IsPrime(<span style=color:#0086f7;font-weight:700>1</span>);
</span></span><span style=display:flex><span>            <span style=color:#080;background-color:#0f140f;font-style:italic>// Assert</span>
</span></span><span style=display:flex><span>            Assert.False(result, <span style=color:#0086d2>&#34;1 should not be prime&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=initialisation-du-test>Initialisation du test
<span><a href=#initialisation-du-test><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Permet d&rsquo;éviter la duplication de code.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>ppublic <span style=color:#fb660a;font-weight:700>class</span> PrimeService_IsPrimeShould
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>private</span> <span style=color:#fb660a;font-weight:700>readonly</span> PrimeService <span style=color:#0086f7;font-weight:700>_</span>primeService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> PrimeService_IsPrimeShould()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// Create instance of tested class</span>
</span></span><span style=display:flex><span>        <span style=color:#0086f7;font-weight:700>_</span>primeService = <span style=color:#fb660a;font-weight:700>new</span> PrimeService();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span></code></pre></div></section><section><h3 id=paramétrage-des-méthodes-de-test>Paramétrage des méthodes de test
<span><a href=#param%c3%a9trage-des-m%c3%a9thodes-de-test><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Theory]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(2)]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(3)]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(5)]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(7)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> IsPrime_PrimesLessThan10_ReturnTrue(<span style=color:#cdcaa9;font-weight:700>int</span> <span style=color:#fb660a;font-weight:700>value</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#cdcaa9;font-weight:700>var</span> result = <span style=color:#0086f7;font-weight:700>_</span>primeService.IsPrime(<span style=color:#fb660a;font-weight:700>value</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Assert.True(result, <span style=color:#0086d2>$&#34;{value} should be prime&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=exécution-des-tests>Exécution des tests
<span><a href=#ex%c3%a9cution-des-tests><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet test</code></p><p><img src=images/dotnet_test_result.png alt="dotnet test result"></p></section><section><h3 id=configuration-dun-projet-de-test-pour-aspnet-core>Configuration d&rsquo;un projet de test pour ASP.NET Core
<span><a href=#configuration-dun-projet-de-test-pour-aspnet-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet add package Microsoft.AspNetCore.Mvc.Testing -v 5.0.12</code></p><p>Ajoute un package dédié aux tests dans cet environnement, ici dans une version adaptée à .NET 5.</p></section><section><h3 id=exemple-de-classe-de-test-1>Exemple de classe de test
<span><a href=#exemple-de-classe-de-test-1><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> System.Threading.Tasks;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> Microsoft.AspNetCore.Mvc.Testing;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> Xunit;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>namespace</span> MvcMovie.Tests
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> HomeControllerTests
</span></span><span style=display:flex><span>    : IClassFixture&lt;WebApplicationFactory&lt;MvcMovie.Startup&gt;&gt;
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>private</span> <span style=color:#fb660a;font-weight:700>readonly</span> WebApplicationFactory&lt;MvcMovie.Startup&gt; <span style=color:#0086f7;font-weight:700>_f</span>actory;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>public</span> HomeControllerTests(WebApplicationFactory&lt;MvcMovie.Startup&gt; factory)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#0086f7;font-weight:700>_f</span>actory = factory;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span></code></pre></div></section><section><h3 id=smoke-testing-dun-contrôleur>Smoke testing d&rsquo;un contrôleur
<span><a href=#smoke-testing-dun-contr%c3%b4leur><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Theory]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(&#34;/&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(&#34;/Home/Index&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(&#34;/Home/Privacy&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task Get_EndpointsReturnSuccessAndCorrectContentType(<span style=color:#cdcaa9;font-weight:700>string</span> url)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// Arrange</span>
</span></span><span style=display:flex><span>        <span style=color:#cdcaa9;font-weight:700>var</span> client = <span style=color:#0086f7;font-weight:700>_f</span>actory.CreateClient();
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// Act</span>
</span></span><span style=display:flex><span>        <span style=color:#cdcaa9;font-weight:700>var</span> response = <span style=color:#fb660a;font-weight:700>await</span> client.GetAsync(url);
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// Assert</span>
</span></span><span style=display:flex><span>        response.EnsureSuccessStatusCode(); <span style=color:#080;background-color:#0f140f;font-style:italic>// Status Code 200-299</span>
</span></span><span style=display:flex><span>        Assert.Equal(<span style=color:#0086d2>&#34;text/html; charset=utf-8&#34;</span>,
</span></span><span style=display:flex><span>            response.Content.Headers.ContentType.ToString());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section></div></div><div><a href=https://ensc.bordeaux-inp.fr><img src=https://www.bpesquet.fr/images/ENSC.jpg style=position:absolute;bottom:10px;left:10px></a></div><script src=https://www.bpesquet.fr/reveal.js/dist/reveal.js></script>
<script src=https://www.bpesquet.fr/reveal.js/plugin/math/math.js></script>
<script>Reveal.initialize({history:!1,slideNumber:!0,transition:"convex",math:{mathjax:"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js",config:"TeX-MML-AM_HTMLorMML"},dependencies:[{src:"https://www.bpesquet.fr/reveal.js/plugin/markdown/marked.js"},{src:"https://www.bpesquet.fr/reveal.js/plugin/markdown/markdown.js"},{src:"https://www.bpesquet.fr/reveal.js/plugin/notes/notes.js",async:!0},{src:"https://www.bpesquet.fr/reveal.js/plugin/zoom-js/zoom.js",async:!0},{src:"https://www.bpesquet.fr/reveal.js/plugin/highlight/highlight.js",async:!0,callback:function(){hljs.initHighlightingOnLoad()}}],plugins:[RevealMath]})</script></body></html>