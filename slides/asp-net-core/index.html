<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>ASP.NET Core</title><link rel=stylesheet href=https://www.bpesquet.fr/reveal.js/dist/reveal.css><link rel=stylesheet href=https://www.bpesquet.fr/reveal.js/dist/theme/white.css></head><body><div class=reveal><div class=slides><section><h1>ASP.NET Core</h1><p><a href=https://ensc.bordeaux-inp.fr>Ecole Nationale Supérieure de Cognitique</a></p><p><a href=https://www.bpesquet.fr>Baptiste Pesquet</a></p></section><section><h2 id=sommaire>Sommaire
<span><a href=#sommaire><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><ul><li>Présentation de ASP.NET Core</li><li>Le framework ASP.NET Core MVC</li><li>Routage et environnement</li><li>Interactions avec une base de données</li><li>Création d&rsquo;API web</li><li>Création de vues HTML</li><li>Tests</li></ul></section><section><h2 id=présentation-daspnet-core>Présentation d&rsquo;ASP.NET Core
<span><a href=#pr%c3%a9sentation-daspnet-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><h3 id=histoire-daspnet-core>Histoire d&rsquo;ASP.NET Core
<span><a href=#histoire-daspnet-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>A l&rsquo;origine, .NET (Framework) incluait une technologie de création de pages web dynamiques nommée <strong>ASP.NET</strong> (<em>Active Server Pages</em>).</li><li><strong>ASP.NET Core</strong> est une réécriture d&rsquo;ASP.NET basée sur .NET (Core).</li><li>Standard actuel pour le développement web sous .NET.</li></ul></section><section><h3 id=points-clés-daspnet-core>Points-clés d&rsquo;ASP.NET Core
<span><a href=#points-cl%c3%a9s-daspnet-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Permet de créer des applications web et des services web (API) utilisés comme <em>backends</em> par des clients riches ou des applications mobiles.</li><li>Léger, moderne et modulaire.</li><li>Inclut des technologies facilitant la gestion des pages dynamiques, des appels temps réel, des tests, etc.</li><li>Déployable sur plusieurs serveurs web : Kestrel, Apache, nginx, etc.</li><li>Multi-plateformes et <a href=https://github.com/dotnet/aspnetcore>open source</a>.</li></ul></section><section><section data-shortcode-section><h3 id=rappel--le-fonctionnement-du-web>Rappel : le fonctionnement du web
<span><a href=#rappel--le-fonctionnement-du-web><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Le web est basé sur un modèle <strong>client/serveur</strong> :</p><ul><li>Le client (navigateur, application mobile, robot d&rsquo;indexation, etc) envoie une demande (<strong>requête</strong>) au serveur.</li><li>Le serveur prépare sa <strong>réponse</strong> à la requête du client, puis la lui renvoie.</li></ul></section><section><p><img src=images/web_request_response.png alt="Modèle requête/réponse du web"></p></section></section><section><h3 id=rappel--le-protocole-http>Rappel : le protocole HTTP
<span><a href=#rappel--le-protocole-http><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><em>HyperText Transfer Protocol</em>.</li><li>Socle technique du web.</li><li>Equivalent sécurisé : <strong>HTTPS</strong>.</li><li>Basé sur des <strong>commandes</strong> textuelles exprimant les différentes actions possibles : <em>GET</em>, <em>PUT</em>, <em>POST</em>, etc).</li></ul></section><section><section data-shortcode-section><h3 id=ui-web-générée-côté-serveur>UI web générée côté serveur
<span><a href=#ui-web-g%c3%a9n%c3%a9r%c3%a9e-c%c3%b4t%c3%a9-serveur><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Structure HTML contenant les données générée côté serveur, puis renvoyée au client.</p><ul><li>Peu d&rsquo;exigences techniques côté client (navigateur simple, trafic réseau limité).</li><li>Accès BD et contrôles centralisés.</li><li>Exemples d&rsquo;usages : sites dynamiques, blogs, CMS&mldr;</li></ul></section><section><p><a href=https://www.growth-rocket.com/blog/a-closer-look-at-client-side-server-side-rendering/><img src=images/Server-Side-Rendering-Flowchart.jpg alt=SSR></a></p></section></section><section><section data-shortcode-section><h3 id=ui-web-générée-côté-client>UI web générée côté client
<span><a href=#ui-web-g%c3%a9n%c3%a9r%c3%a9e-c%c3%b4t%c3%a9-client><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Squelette HTML (sans données) initialement renvoyé au client. Ensuite, DOM mis à jour dynamiquement grâce à des appels asynchrones du client vers le serveur.</p><ul><li>Interactions riches avec l&rsquo;utilisateur.</li><li>Capacités matérielles et logicielles du client utilisables.</li><li>Exemples d&rsquo;usages : tableau de bord interactif, applications collaboratives&mldr;</li></ul></section><section><p><a href=https://www.growth-rocket.com/blog/a-closer-look-at-client-side-server-side-rendering/><img src=images/Client-Side-Rendering-Flowchart.jpg alt=CSR></a></p></section></section><section><h3 id=loffre-technique-aspnet-core>L&rsquo;offre technique ASP.NET Core
<span><a href=#loffre-technique-aspnet-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>UI générée côté serveur : <strong>Razor Pages</strong>, <strong>MVC</strong>.</li><li>UI générée côté client : <strong>Blazor</strong>, <strong>SPA</strong> avec Angular ou React.</li><li>Une approche hybride est possible (exemple : MVC + Blazor).</li></ul></section><section><h2 id=le-framework-aspnet-core-mvc>Le framework ASP.NET Core MVC
<span><a href=#le-framework-aspnet-core-mvc><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><h3 id=larchitecture-mvc>L&rsquo;architecture MVC
<span><a href=#larchitecture-mvc><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><em>Model-View-Controller</em> (<em>Modèle-Vue-Contrôleur</em>).</li><li>Décomposition d’une application en trois grandes parties :<ul><li><strong>Modèle</strong> : accès aux données et logique métier (<em>business logic</em>).</li><li><strong>Vue</strong> : affichage et interactions avec l’utilisateur.</li><li><strong>Contrôleur</strong> : dynamique de l’application, lien entre Modèle et Vue.</li></ul></li><li>Application du principe de séparation des responsabilités.</li></ul></section><section><h3 id=mvc--un-peu-dhistoire>MVC : un peu d&rsquo;histoire
<span><a href=#mvc--un-peu-dhistoire><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Apparu à la fin des années 1970 pour le langage OO <strong>Smalltalk</strong>. Objectif : séparer le code de l’IHM de la logique applicative.</li><li>Appliqué depuis dans de très nombreux contextes et langages :<ul><li>web côté serveur : frameworks Symfony (PHP), Django (Python), Rails (Ruby), etc.</li><li>web côté client : frameworks Angular, Ember (JavaScript), etc.</li><li>desktop : bibliothèque Swing (Java), etc.</li></ul></li></ul></section><section><p><a href=https://symfony.com/doc/current/index.html><img src=images/symfony_mvc.png alt="Dynamique d&amp;rsquo;un serveur web MVC"></a></p></section><section><h3 id=avantages-et-inconvénients>Avantages et inconvénients
<span><a href=#avantages-et-inconv%c3%a9nients><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><p>Avantages :</p><ul><li>Séparation nette des responsabilités => couplage faible, cohésion forte, maintenance et évolutions facilitées.</li><li>Standard connu et bien établi.</li></ul></li><li><p>Inconvénients :</p><ul><li>Complexification de l’architecture.</li><li>Rigidité.</li></ul></li></ul></section><section><h3 id=aspnet-core-mvc>ASP.NET Core MVC
<span><a href=#aspnet-core-mvc><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Framework de création d&rsquo;applications web basées sur l&rsquo;architecture MVC.</li><li>Implémente de nombreux services et bonnes pratiques, parmi lesquels :<ul><li>Routage des requêtes entrantes.</li><li>Gestion des pages dynamiques.</li><li>Authentification.</li><li>Injection de dépendance.</li><li>Tests.</li><li>&mldr;</li></ul></li></ul></section><section><h3 id=creation-dune-application-aspnet-core-mvc>Creation d&rsquo;une application ASP.NET Core MVC
<span><a href=#creation-dune-application-aspnet-core-mvc><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet new mvc -o {AppName}
</span></span><span style=display:flex><span>cd {AppName}
</span></span><span style=display:flex><span>dotnet new gitignore
</span></span></code></pre></div></section><section><h3 id=structure-de-lapplication-créée>Structure de l&rsquo;application créée
<span><a href=#structure-de-lapplication-cr%c3%a9%c3%a9e><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><a href=https://github.com/ensc-glog/MvcMovie>https://github.com/ensc-glog/MvcMovie</a></p><p><img src=images/aspnetcoremvc_structure.png alt="Structure d&amp;rsquo;une application ASP.NET Core MVC"></p></section><section><h3 id=les-contrôleurs>Les contrôleurs
<span><a href=#les-contr%c3%b4leurs><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Créés dans le répertoire <code>Controllers/</code>.</li><li>Définis dans l&rsquo;espace de noms <code>{AppName}/Controllers</code>.</li><li>Héritent des classes abstraites <code>Controller</code> (vues HTML) ou <code>ControllerBase</code> (API web).</li><li>Définissent les points d&rsquo;entrée dans l&rsquo;application sous la forme de méthodes d&rsquo;action annotables.</li></ul></section><section><h3 id=exemple-de-contrôleur>Exemple de contrôleur
<span><a href=#exemple-de-contr%c3%b4leur><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>namespace</span> MvcMovie.Controllers;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> HomeController : Controller
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> IActionResult Index()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>return</span> View();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> IActionResult Privacy()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>return</span> View();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=les-modèles>Les modèles
<span><a href=#les-mod%c3%a8les><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Créés dans le répertoire <code>Models/</code>.</li><li>Définis dans l&rsquo;espace de noms <code>{AppName}/Models</code>.</li><li>Implémentent la logique métier de l&rsquo;application sous la forme de classes <strong>POCO</strong> (<em>Plain Old CLR Objects</em>) souvent associées à des tables BD.</li></ul></section><section><h3 id=les-vues>Les vues
<span><a href=#les-vues><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Créées dans le répertoire <code>Views/{ControllerName}</code> sous la forme de fichiers <a href="https://learn.microsoft.com/en-us/aspnet/core/razor-pages/?view=aspnetcore-6.0&tabs=visual-studio">Razor</a> (<code>.cshtml</code>).</li><li>Représentent l&rsquo;interface utilisateur (UI) de l&rsquo;application.</li></ul><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>@{
</span></span><span style=display:flex><span>    ViewData[<span style=color:#0086d2>&#34;Title&#34;</span>] = <span style=color:#0086d2>&#34;Home Page&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;div class=<span style=color:#0086d2>&#34;text-center&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;h1 class=<span style=color:#0086d2>&#34;display-4&#34;</span>&gt;Welcome&lt;/h1&gt;
</span></span><span style=display:flex><span>    &lt;p&gt;Learn about &lt;a href=<span style=color:#0086d2>&#34;https://docs.microsoft.com/aspnet/core&#34;</span>&gt;building Web apps with ASP.NET Core&lt;/a&gt;.&lt;/p&gt;
</span></span><span style=display:flex><span>&lt;/div&gt;
</span></span></code></pre></div></section><section><h3 id=code-et-librairies-client>Code et librairies client
<span><a href=#code-et-librairies-client><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Regroupés dans le répertoire <code>wwwroot/</code>.</li><li>Rassemblent les fichiers CSS et JavaScript utilisés côté client.</li><li>Intègrent par défaut Bootstrap et jQuery.</li></ul><p><img src=images/aspnetcoremvc_wwwroot.png alt="wwwroot folder structure"></p></section><section><h3 id=le-fichier-appsettingsjson>Le fichier appsettings.json
<span><a href=#le-fichier-appsettingsjson><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Centralise les paramètres de configuration de l&rsquo;application.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#fb660a;font-weight:700>&#34;Logging&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>&#34;LogLevel&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;Default&#34;</span>: <span style=color:#0086d2>&#34;Information&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;Microsoft.AspNetCore&#34;</span>: <span style=color:#0086d2>&#34;Warning&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;Microsoft.EntityFrameworkCore.Database.Command&#34;</span>: <span style=color:#0086d2>&#34;Information&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=le-fichier-programcs>Le fichier Program.cs
<span><a href=#le-fichier-programcs><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Configure les services utilisés et le <em>pipeline</em> de gestion des requêtes HTTP entrantes.</li><li>Démarre l&rsquo;application.</li></ul><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#cdcaa9;font-weight:700>var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// Add services to the container.</span>
</span></span><span style=display:flex><span>builder.Services.AddControllersWithViews();
</span></span><span style=display:flex><span><span style=color:#cdcaa9;font-weight:700>var</span> app = builder.Build();
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>app.UseHttpsRedirection();
</span></span><span style=display:flex><span>app.UseStaticFiles();
</span></span><span style=display:flex><span>app.UseRouting();
</span></span><span style=display:flex><span>app.UseAuthorization();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.MapControllerRoute(
</span></span><span style=display:flex><span>    name: <span style=color:#0086d2>&#34;default&#34;</span>,
</span></span><span style=display:flex><span>    pattern: <span style=color:#0086d2>&#34;{controller=Home}/{action=Index}/{id?}&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.Run();
</span></span></code></pre></div></section><section><h3 id=lancement-de-lapplication>Lancement de l&rsquo;application
<span><a href=#lancement-de-lapplication><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>En ligne de commande avec <code>dotnet run</code> ou depuis VS Code, après avoir généré les <em>assets</em>.</li><li>Compile le code puis écoute un port aléatoire > 1000 pour attendre les requêtes HTTP entrantes sur la machine locale.</li><li>Recompilation nécessaire après tout changement.</li></ul><p><img src=images/dotnet-run.png alt="dotnet run"></p></section><section><h2 id=routage-et-environnement>Routage et environnement
<span><a href=#routage-et-environnement><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><h3 id=routage-des-requêtes>Routage des requêtes
<span><a href=#routage-des-requ%c3%aates><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Associe les requêtes HTTP entrantes au code à exécuter (méthodes des contrôleurs).</li><li>Permet à l&rsquo;application web d&rsquo;utiliser des URL propres et <em>SEO-friendly</em>, plutôt que des noms de fichiers.</li><li><a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/controllers/routing?view=aspnetcore-5.0">Plus d&rsquo;informations</a>.</li></ul></section><section><h3 id=routage-par-convention>Routage par convention
<span><a href=#routage-par-convention><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Permet de définir globalement la correspondance entre le format de l&rsquo;URL et la méthode d&rsquo;action d&rsquo;un contrôleur à exécuter.</li><li>Format par défaut : <code>/{ControllerName}/{ActionName}?{Parameters}</code>.</li><li>Exemple : <code>https://myapp/Student/Details?code=137</code> appelle la méthode <code>Details</code> du contrôleur <code>StudentController</code>, en lui passant un paramètre nommé <code>code</code> ayant la valeur 137.</li></ul></section><section><h3 id=configuration-du-routage-par-convention-dans-programcs>Configuration du routage par convention dans Program.cs
<span><a href=#configuration-du-routage-par-convention-dans-programcs><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>app.MapControllerRoute(
</span></span><span style=display:flex><span>    name: <span style=color:#0086d2>&#34;default&#34;</span>,
</span></span><span style=display:flex><span>    pattern: <span style=color:#0086d2>&#34;{controller=Home}/{action=Index}/{id?}&#34;</span>);
</span></span></code></pre></div><p><code>Home</code>, <code>Index</code> et <code>id</code> sont resp. les noms par défaut du contrôleur, de l&rsquo;action et du paramètre (optionnel).</p></section><section><h3 id=exemple--ajout-dun-contrôleur>Exemple : ajout d&rsquo;un contrôleur
<span><a href=#exemple--ajout-dun-contr%c3%b4leur><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Dans le fichier <code>Controllers/HelloController.cs</code>.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> Microsoft.AspNetCore.Mvc;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>namespace</span> MvcMovie.Controllers;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> HelloController : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// GET: /Hello/</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Index()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>return</span> <span style=color:#0086d2>&#34;Hello World!&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=utilisation-du-contrôleur-créé>Utilisation du contrôleur créé
<span><a href=#utilisation-du-contr%c3%b4leur-cr%c3%a9%c3%a9><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>L&rsquo;URL <a href=https://localhost:%7Bport%7D/hello>https://localhost:{port}/hello</a> est automatiquement routée vers la méthode <code>Index</code> de la classe <code>HelloController</code>.</li><li>Même résultat avec <a href=https://localhost:%7Bport%7D/hello/index>https://localhost:{port}/hello/index</a>, <code>Index</code> étant le nom de l&rsquo;action par défaut.</li></ul><p><img src=images/helloworldcontroller.png alt="Hello World!"></p></section><section><h3 id=passage-de-paramètres-à-un-contrôleur>Passage de paramètres à un contrôleur
<span><a href=#passage-de-param%c3%a8tres-%c3%a0-un-contr%c3%b4leur><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>On définit des paramètres dans l&rsquo;URL via la syntaxe <code>?{name1}={value1}&{name2}=...</code></li><li>Leurs valeurs sont passées aux méthodes d&rsquo;actions des contrôleurs.</li></ul><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> System.Text.Encodings.Web;
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> HelloController : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// GET: /Hello/Welcome/ </span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Welcome(<span style=color:#cdcaa9;font-weight:700>string</span> name, <span style=color:#cdcaa9;font-weight:700>int</span> numTimes = <span style=color:#0086f7;font-weight:700>1</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// Prevents injection attacks</span>
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>return</span> HtmlEncoder.Default.Encode(<span style=color:#0086d2>$&#34;Hello {name}, NumTimes is: {numTimes}&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=exemple--passage-de-paramètres-au-contrôleur-créé>Exemple : passage de paramètres au contrôleur créé
<span><a href=#exemple--passage-de-param%c3%a8tres-au-contr%c3%b4leur-cr%c3%a9%c3%a9><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>L&rsquo;URL <a href=https://localhost:%7Bport%7D/hello/welcome>https://localhost:{port}/hello/welcome</a> est automatiquement routée vers la méthode <code>Welcome</code> de la classe <code>HelloController</code>.</li><li>On peut définir (ou pas) les valeurs des paramètres <code>name</code> et <code>numTimes</code>.</li></ul><p><img src=images/welcomecontroller.png alt=Welcome></p></section><section><h3 id=environnements>Environnements
<span><a href=#environnements><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Permettent d&rsquo;adapter la configuration de l&rsquo;application au contexte (développement, test ou production).</li><li>Définis par la variable d&rsquo;environnement <code>ASPNETCORE_ENVIRONMENT</code>. En l&rsquo;absence de cette variable, l&rsquo;environnement est de type Production.</li><li><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-5.0">Plus d&rsquo;informations</a>.</li></ul></section><section><h3 id=définition-de-lenvironnement-avec-visual-studio-code>Définition de l&rsquo;environnement avec Visual Studio Code
<span><a href=#d%c3%a9finition-de-lenvironnement-avec-visual-studio-code><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Dans le fichier <code>./vscode/launch.json</code></p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#fb660a;font-weight:700>&#34;version&#34;</span>: <span style=color:#0086d2>&#34;0.2.0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#fb660a;font-weight:700>&#34;configurations&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;name&#34;</span>: <span style=color:#0086d2>&#34;.NET Core Launch (web)&#34;</span>,
</span></span><span style=display:flex><span>      # ...
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;env&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>&#34;ASPNETCORE_ENVIRONMENT&#34;</span>: <span style=color:#0086d2>&#34;Development&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      # ...
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=configuration-de-lapplication-selon-lenvironnement-détecté>Configuration de l&rsquo;application selon l&rsquo;environnement détecté
<span><a href=#configuration-de-lapplication-selon-lenvironnement-d%c3%a9tect%c3%a9><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Dans le fichier <code>Program.cs</code>.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// Configure the HTTP request pipeline.</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>if</span> (!app.Environment.IsDevelopment())
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    app.UseExceptionHandler(<span style=color:#0086d2>&#34;/Home/Error&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// The default HSTS value is 30 days. You may want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts.</span>
</span></span><span style=display:flex><span>    app.UseHsts();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>else</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    app.UseDeveloperExceptionPage();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h2 id=interactions-avec-une-base-de-données>Interactions avec une base de données
<span><a href=#interactions-avec-une-base-de-donn%c3%a9es><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><h3 id=ef-core-et-aspnet-core>EF Core et ASP.NET Core
<span><a href=#ef-core-et-aspnet-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Entity Framework Core est la solution de persistance par défaut sous ASP.NET Core.</li><li>Après son installation, on configure l&rsquo;application pour <a href=https://docs.microsoft.com/en-us/ef/core/dbcontext-configuration/>associer</a> un contexte BD à chaque requête HTTP entrante.</li><li>Il est ensuite utilisé par les contrôleurs pour interagir avec la base de données.</li></ul></section><section><h3 id=exemple--ajout-dune-classe-métier>Exemple : ajout d&rsquo;une classe métier
<span><a href=#exemple--ajout-dune-classe-m%c3%a9tier><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Dans le fichier <code>Models/Movie.cs</code>.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> System.ComponentModel.DataAnnotations;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>namespace</span> MvcMovie.Models;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Movie
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>int</span> Id { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Title { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; } = <span style=color:#fb660a;font-weight:700>null</span>!;
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>
</span></span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Display(Name = &#34;Release Date&#34;), DataType(DataType.Date)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> DateTime ReleaseDate { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Genre { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; } = <span style=color:#fb660a;font-weight:700>null</span>!;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=création-du-contexte-bd>Création du contexte BD
<span><a href=#cr%c3%a9ation-du-contexte-bd><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Dans le fichier <code>Data/MvcMovieContext.cs</code>.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> Microsoft.EntityFrameworkCore;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> MvcMovie.Models;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>namespace</span> MvcMovie.Data;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> MvcMovieContext : DbContext
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> DbSet&lt;Movie&gt; Movies { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; } = <span style=color:#fb660a;font-weight:700>null</span>!;
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> DbPath { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>private</span> <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> MvcMovieContext()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// Path to SQLite database file</span>
</span></span><span style=display:flex><span>        DbPath = <span style=color:#0086d2>&#34;MvcMovie.db&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// The following configures EF to create a SQLite database file locally</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>protected</span> <span style=color:#fb660a;font-weight:700>override</span> <span style=color:#fb660a;font-weight:700>void</span> OnConfiguring(DbContextOptionsBuilder options)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// Use SQLite as database</span>
</span></span><span style=display:flex><span>        options.UseSqlite(<span style=color:#0086d2>$&#34;Data Source={DbPath}&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// Optional: log SQL queries to console</span>
</span></span><span style=display:flex><span>        options.LogTo(Console.WriteLine, <span style=color:#fb660a;font-weight:700>new</span>[] { DbLoggerCategory.Database.Command.Name }, LogLevel.Information);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=synchronisation-de-la-base-de-données-avec-le-modèle>Synchronisation de la base de données avec le modèle
<span><a href=#synchronisation-de-la-base-de-donn%c3%a9es-avec-le-mod%c3%a8le><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Réalisée via des migrations.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># Create a new migration</span>
</span></span><span style=display:flex><span>dotnet ef migrations add {MigratioName}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># Sync DB with most recent migrations</span>
</span></span><span style=display:flex><span>dotnet ef database update
</span></span></code></pre></div></section><section><h3 id=configuration-de-lapplication-pour-ef-core>Configuration de l&rsquo;application pour EF Core
<span><a href=#configuration-de-lapplication-pour-ef-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Dans le fichier <code>Program.cs</code>.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> MvcMovie.Data;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cdcaa9;font-weight:700>var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// Add services to the container.</span>
</span></span><span style=display:flex><span>builder.Services.AddControllersWithViews();
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// Attach an EF Core database context to each query</span>
</span></span><span style=display:flex><span>builder.Services.AddDbContext&lt;MvcMovieContext&gt;();
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span></code></pre></div></section><section><h3 id=gestion-des-fichiers-temporaires-sqlite>Gestion des fichiers temporaires SQLite
<span><a href=#gestion-des-fichiers-temporaires-sqlite><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Edition du fichier <code>.gitignore</code> pour ignorer ces fichiers.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># Ignore SQLite temp files</span>
</span></span><span style=display:flex><span>*.db-shm
</span></span><span style=display:flex><span>*.db-wal
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># ...</span>
</span></span></code></pre></div></section><section><h3 id=remplissage-de-la-base-de-données>Remplissage de la base de données
<span><a href=#remplissage-de-la-base-de-donn%c3%a9es><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Classe <code>SeedData</code> créée dans le répertoire <code>Models/</code>.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> MvcMovie.Data;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>namespace</span> MvcMovie.Models;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> SeedData
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>static</span> <span style=color:#fb660a;font-weight:700>void</span> Init()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>using</span> (<span style=color:#cdcaa9;font-weight:700>var</span> context = <span style=color:#fb660a;font-weight:700>new</span> MvcMovieContext())
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#080;background-color:#0f140f;font-style:italic>// Look for existing content</span>
</span></span><span style=display:flex><span>            <span style=color:#fb660a;font-weight:700>if</span> (context.Movies.Any())
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#fb660a;font-weight:700>return</span>;   <span style=color:#080;background-color:#0f140f;font-style:italic>// DB already filled</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#080;background-color:#0f140f;font-style:italic>// Add several movies</span>
</span></span><span style=display:flex><span>            context.Movies.AddRange(
</span></span><span style=display:flex><span>                                <span style=color:#fb660a;font-weight:700>new</span> Movie
</span></span><span style=display:flex><span>                                {
</span></span><span style=display:flex><span>                                    Title = <span style=color:#0086d2>&#34;When Harry Met Sally&#34;</span>,
</span></span><span style=display:flex><span>                                    ReleaseDate = DateTime.Parse(<span style=color:#0086d2>&#34;1989-2-12&#34;</span>),
</span></span><span style=display:flex><span>                                    Genre = <span style=color:#0086d2>&#34;Romantic Comedy&#34;</span>,
</span></span><span style=display:flex><span>                                },
</span></span><span style=display:flex><span>                                <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>                            );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#080;background-color:#0f140f;font-style:italic>// Commit changes into DB</span>
</span></span><span style=display:flex><span>            context.SaveChanges();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=exécution-du-code-de-remplissage>Exécution du code de remplissage
<span><a href=#ex%c3%a9cution-du-code-de-remplissage><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Dans le fichier <code>Program.cs</code>.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> MvcMovie.Data;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> MvcMovie.Models;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cdcaa9;font-weight:700>var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// Add services to the container.</span>
</span></span><span style=display:flex><span>builder.Services.AddControllersWithViews();
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// Attach an EF Core database context to each query</span>
</span></span><span style=display:flex><span>builder.Services.AddDbContext&lt;MvcMovieContext&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cdcaa9;font-weight:700>var</span> app = builder.Build();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// Seed data into DB</span>
</span></span><span style=display:flex><span>SeedData.Init();
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span></code></pre></div></section><section><h2 id=création-dapi-web>Création d&rsquo;API web
<span><a href=#cr%c3%a9ation-dapi-web><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><h3 id=la-notion-dapi>La notion d&rsquo;API
<span><a href=#la-notion-dapi><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Une <strong>API</strong> (<em>Application Programming Interface</em>) est un point d&rsquo;entrée programmatique dans un système.</li><li>Elle fournit un moyen d&rsquo;interagir avec ce système.</li><li>Les API permettent aux développeurs d&rsquo;intégrer des services externes dans leurs applications.</li></ul></section><section><h3 id=spécificités-des-api-web>Spécificités des API web
<span><a href=#sp%c3%a9cificit%c3%a9s-des-api-web><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Une <strong>API web</strong> (appelée parfois service web) est une API accessible via les technologies du web : HTTP ou HTTPS.</li><li>Les API web utilisent le plus souvent le format de donnée <strong>JSON</strong>.</li><li>Certaines sont librement utilisables mais la plupart nécessitent une authentification du client.</li></ul></section><section><section data-shortcode-section><h3 id=le-format-json>Le format JSON
<span><a href=#le-format-json><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>JSON = JavaScript Object Notation.</li><li>Format de description de données structurées inspiré de la syntaxe des objets JavaScript.</li><li>Contenu JSON = ensemble de paires champ/valeur.</li><li>Types de valeur possibles : nombres, chaînes, booléens, tableaux, objets.</li><li>A supplanté XML comme format standard pour les échanges de données via des API web.</li></ul></section><section><h3 id=exemple-de-contenu-json>Exemple de contenu JSON
<span><a href=#exemple-de-contenu-json><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#fb660a;font-weight:700>&#34;cars&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;model&#34;</span>: <span style=color:#0086d2>&#34;Peugeot&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;color&#34;</span>: <span style=color:#0086d2>&#34;blue&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;checkups&#34;</span>: [<span style=color:#0086f7;font-weight:700>2015</span>, <span style=color:#0086f7;font-weight:700>2017</span>]
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;model&#34;</span>: <span style=color:#0086d2>&#34;Citroën&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;color&#34;</span>: <span style=color:#0086d2>&#34;white&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#fb660a;font-weight:700>&#34;checkups&#34;</span>: [<span style=color:#0086f7;font-weight:700>2003</span>, <span style=color:#0086f7;font-weight:700>2005</span>, <span style=color:#0086f7;font-weight:700>2007</span>, <span style=color:#0086f7;font-weight:700>2009</span>, <span style=color:#0086f7;font-weight:700>2011</span>, <span style=color:#0086f7;font-weight:700>2013</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section></section><section><h3 id=exemples-dapi-web>Exemples d&rsquo;API web
<span><a href=#exemples-dapi-web><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><a href=https://pokeapi.co/>PokéAPI</a></li><li><a href=https://swapi.dev/>Star Wars API</a></li><li><a href=https://en.wikipedia.org/w/api.php?>Wikipedia</a></li><li><a href=https://developer.spotify.com/documentation/web-api/>Spotify</a></li><li><a href=https://www.omdbapi.com/>OMDb API</a></li><li>&mldr;</li></ul></section><section><h3 id=outils-pour-la-gestion-des-api-web>Outils pour la gestion des API web
<span><a href=#outils-pour-la-gestion-des-api-web><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>N&rsquo;importe quel navigateur pour les tests basiques.</li><li>Extension <a href=https://addons.mozilla.org/fr/firefox/addon/restclient/>RESTClient</a> pour Firefox.</li><li><a href=https://www.getpostman.com/>Postman</a>.</li><li>&mldr;</li></ul></section><section><h3 id=les-api-restful>Les API RESTful
<span><a href=#les-api-restful><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><strong>REST</strong> (<em>REpresentational State Transfer</em>) est un ensemble de principes pour créer des API : client/serveur, pas de gestion d&rsquo;état, etc.</li><li>Une API web <em>RESTful</em> (conforme au standard REST) expose une interface basée sur les commandes HTTP. Exemples :<ul><li><code>GET /&lt;ResourceName>/&lt;id></code> pour accéder à une ressource.</li><li><code>POST /&lt;ResourceName></code> (avec les informations nécessaires dans le corps de la requête) pour la créer.</li></ul></li></ul></section><section><h3 id=fonctionnement-dune-api-web-avec-aspnet-core-mvc>Fonctionnement d&rsquo;une API web avec ASP.NET Core MVC
<span><a href=#fonctionnement-dune-api-web-avec-aspnet-core-mvc><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><img src=images/aspnetcore_api.png alt="API call with ASP.NET Core"></p></section><section><h3 id=création-dun-contrôleur-dapi>Création d&rsquo;un contrôleur d&rsquo;API
<span><a href=#cr%c3%a9ation-dun-contr%c3%b4leur-dapi><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Dans le répertoire <code>Controllers/</code>.</li><li>Hérite de la classe <code>ControllerBase</code>.</li><li>Associé aux routes du type <code>api/{ApiControllerName}/</code>.</li></ul></section><section><h3 id=exemple-de-contrôleur-dapi>Exemple de contrôleur d&rsquo;API
<span><a href=#exemple-de-contr%c3%b4leur-dapi><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Dans le fichier <code>Controllers/MovieApiController.cs</code>.</li><li>La conversion au format JSON est implicite.</li></ul><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> Microsoft.AspNetCore.Mvc;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> Microsoft.EntityFrameworkCore;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> MvcMovie.Data;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> MvcMovie.Models;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>namespace</span> MvcMovie.Controllers;
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>
</span></span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>[Route(&#34;api/[controller]</span><span style=color:#0086d2>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span><span style=color:#ff0086;font-weight:700>[ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> MovieApiController : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>private</span> <span style=color:#fb660a;font-weight:700>readonly</span> MvcMovieContext _context;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> MovieApiController(MvcMovieContext context)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        _context = context;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// GET: api/MovieApi</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task&lt;ActionResult&lt;IEnumerable&lt;Movie&gt;&gt;&gt; GetMovies()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>return</span> <span style=color:#fb660a;font-weight:700>await</span> _context.Movies.ToListAsync();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=requêtes-synchrones>Requêtes synchrones
<span><a href=#requ%c3%aates-synchrones><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><a href=https://code-maze.com/asynchronous-programming-with-async-and-await-in-asp-net-core/><img src=images/sync-request-asp.net-core.png alt="Synchronous requests"></a></p></section><section><h3 id=requêtes-asynchrones>Requêtes asynchrones
<span><a href=#requ%c3%aates-asynchrones><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><a href=https://code-maze.com/asynchronous-programming-with-async-and-await-in-asp-net-core/><img src=images/async-request-asp.net-core.png alt="Asynchronous requests"></a></p></section><section><h3 id=résultat-de-lappel-à-lapi>Résultat de l&rsquo;appel à l&rsquo;API
<span><a href=#r%c3%a9sultat-de-lappel-%c3%a0-lapi><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><img src=images/movieapi.png alt="Movie API"></p></section><section><h3 id=accès-à-un-élément>Accès à un élément
<span><a href=#acc%c3%a8s-%c3%a0-un-%c3%a9l%c3%a9ment><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>[Route(&#34;api/[controller]</span><span style=color:#0086d2>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span><span style=color:#ff0086;font-weight:700>[ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> MovieApiController : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// GET: api/MovieApi/5</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [HttpGet(&#34;{id}&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task&lt;ActionResult&lt;Movie&gt;&gt; GetMovie(<span style=color:#cdcaa9;font-weight:700>int</span> id)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#cdcaa9;font-weight:700>var</span> movie = <span style=color:#fb660a;font-weight:700>await</span> _context.Movies.FindAsync(id);
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>if</span> (movie == <span style=color:#fb660a;font-weight:700>null</span>)
</span></span><span style=display:flex><span>            <span style=color:#fb660a;font-weight:700>return</span> NotFound();
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>return</span> movie;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=test-daccès>Test d&rsquo;accès
<span><a href=#test-dacc%c3%a8s><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Envoyer une requête HTTP GET vers l&rsquo;URL <a href=https://localhost:%7Bport%7D/api/movieapi/%7BmovieId%7D>https://localhost:{port}/api/movieapi/{movieId}</a>.</p><p><img src=images/movieapi-getone.png alt="Get one movie"></p></section><section><h3 id=création-dun-élément>Création d&rsquo;un élément
<span><a href=#cr%c3%a9ation-dun-%c3%a9l%c3%a9ment><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>[Route(&#34;api/[controller]</span><span style=color:#0086d2>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span><span style=color:#ff0086;font-weight:700>[ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> MovieApiController : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// POST: api/MovieApi</span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// To protect from overposting attacks, see https://go.microsoft.com/fwlink/?linkid=2123754</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [HttpPost]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task&lt;ActionResult&lt;Movie&gt;&gt; PostMovie(Movie movie)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        _context.Movies.Add(movie);
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>await</span> _context.SaveChangesAsync();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>return</span> CreatedAtAction(<span style=color:#0086d2>&#34;GetTodo&#34;</span>, <span style=color:#fb660a;font-weight:700>new</span> { id = movie.Id }, movie);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=test-de-création>Test de création
<span><a href=#test-de-cr%c3%a9ation><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Envoyer une requête HTTP POST en spécifiant la valeur du champ <code>Content-type</code> à <code>application/json</code>.</li><li>Le contenu JSON de la requête doit inclure les propriétés obligatoires du nouvel élément.</li><li>Exemple avec l&rsquo;outil <a href=https://curl.se/>curl</a>:</li></ul><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST -k -H <span style=color:#0086d2>&#39;Content-Type: application/json&#39;</span> -i https://localhost:{port}/api/movieapi/ --data <span style=color:#0086d2>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#0086d2>    &#34;Title&#34;: &#34;1941&#34;,
</span></span></span><span style=display:flex><span><span style=color:#0086d2>    &#34;ReleaseDate&#34;: &#34;1979-12-14T00:00:00&#34;,
</span></span></span><span style=display:flex><span><span style=color:#0086d2>    &#34;Genre&#34;: &#34;Comedy&#34;
</span></span></span><span style=display:flex><span><span style=color:#0086d2>}&#39;</span>
</span></span></code></pre></div></section><section><h3 id=mise-à-jour-dun-élément-existant>Mise à jour d&rsquo;un élément existant
<span><a href=#mise-%c3%a0-jour-dun-%c3%a9l%c3%a9ment-existant><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>[Route(&#34;api/[controller]</span><span style=color:#0086d2>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span><span style=color:#ff0086;font-weight:700>[ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> MovieApiController : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// PUT: api/MovieApi/5</span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// To protect from overposting attacks, see https://go.microsoft.com/fwlink/?linkid=2123754</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [HttpPut(&#34;{id}&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task&lt;IActionResult&gt; PutMovie(<span style=color:#cdcaa9;font-weight:700>int</span> id, Movie movie)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>if</span> (id != movie.Id)
</span></span><span style=display:flex><span>            <span style=color:#fb660a;font-weight:700>return</span> BadRequest();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        _context.Entry(movie).State = EntityState.Modified;
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>try</span>
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#fb660a;font-weight:700>await</span> _context.SaveChangesAsync();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>catch</span> (DbUpdateConcurrencyException)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#fb660a;font-weight:700>if</span> (!MovieExists(id))
</span></span><span style=display:flex><span>                <span style=color:#fb660a;font-weight:700>return</span> NotFound();
</span></span><span style=display:flex><span>            <span style=color:#fb660a;font-weight:700>else</span>
</span></span><span style=display:flex><span>                <span style=color:#fb660a;font-weight:700>throw</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>return</span> NoContent();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// Returns true if a movie with specified id already exists</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>private</span> <span style=color:#cdcaa9;font-weight:700>bool</span> MovieExists(<span style=color:#cdcaa9;font-weight:700>int</span> id)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>return</span> _context.Movies.Any(m =&gt; m.Id == id);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=test-de-mise-à-jour>Test de mise à jour
<span><a href=#test-de-mise-%c3%a0-jour><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Envoyer une requête HTTP PUT vers l&rsquo;élément à modifier, en spécifiant la valeur du champ <code>Content-type</code> à <code>application/json</code>.</li><li>Le contenu JSON de la requête doit inclure toutes les propriétés de l&rsquo;élément modifié.</li><li>Exemple avec l&rsquo;outil <a href=https://curl.se/>curl</a>:</li></ul><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X PUT -k -H <span style=color:#0086d2>&#39;Content-Type: application/json&#39;</span> -i https://localhost:7294/api/movieapi/5 --data <span style=color:#0086d2>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#0086d2>    &#34;Id&#34;: 5,
</span></span></span><span style=display:flex><span><span style=color:#0086d2>    &#34;Title&#34;: &#34;1941 (movie)&#34;,
</span></span></span><span style=display:flex><span><span style=color:#0086d2>    &#34;ReleaseDate&#34;: &#34;1979-12-14T00:00:00&#34;,
</span></span></span><span style=display:flex><span><span style=color:#0086d2>    &#34;Genre&#34;: &#34;Comedy&#34;
</span></span></span><span style=display:flex><span><span style=color:#0086d2>}&#39;</span>
</span></span></code></pre></div></section><section><h3 id=suppression-dun-élément>Suppression d&rsquo;un élément
<span><a href=#suppression-dun-%c3%a9l%c3%a9ment><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>[Route(&#34;api/[controller]</span><span style=color:#0086d2>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span><span style=color:#ff0086;font-weight:700>[ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> MovieApiController : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// DELETE: api/MovieApi/5</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [HttpDelete(&#34;{id}&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task&lt;IActionResult&gt; DeleteMovie(<span style=color:#cdcaa9;font-weight:700>int</span> id)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#cdcaa9;font-weight:700>var</span> movie = <span style=color:#fb660a;font-weight:700>await</span> _context.Movies.FindAsync(id);
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>if</span> (movie == <span style=color:#fb660a;font-weight:700>null</span>)
</span></span><span style=display:flex><span>            <span style=color:#fb660a;font-weight:700>return</span> NotFound();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        _context.Movies.Remove(movie);
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>await</span> _context.SaveChangesAsync();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>return</span> NoContent();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span></code></pre></div></section><section><h3 id=test-de-suppression>Test de suppression
<span><a href=#test-de-suppression><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Envoyer une requête HTTP DELETE vers l&rsquo;URL <a href=https://localhost:%7Bport%7D/api/movieapi/%7BmovieId%7D>https://localhost:{port}/api/movieapi/{movieId}</a>.</p></section><section><h3 id=récapitulatif--api-créée>Récapitulatif : API créée
<span><a href=#r%c3%a9capitulatif--api-cr%c3%a9%c3%a9e><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><table><thead><tr><th>Route</th><th>Description</th></tr></thead><tbody><tr><td><code>GET /api/MovieApi</code></td><td>Renvoie tous les films</td></tr><tr><td><code>GET /api/MovieApi/{id}</code></td><td>Renvoie un film</td></tr><tr><td><code>POST /api/MovieApi</code></td><td>Ajoute un nouvel film</td></tr><tr><td><code>PUT /api/MovieApi/{id}</code></td><td>Met à jour un film</td></tr><tr><td><code>DELETE /api/MovieApi/{id}</code></td><td>Supprime un film</td></tr></tbody></table></section><section><h2 id=création-de-vues-html>Création de vues HTML
<span><a href=#cr%c3%a9ation-de-vues-html><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><section data-shortcode-section><h3 id=envoi-de-données-aux-vues--viewdata>Envoi de données aux vues : ViewData
<span><a href=#envoi-de-donn%c3%a9es-aux-vues--viewdata><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Approche <em>faiblement typée</em> : on utilie un dictionnaire standard.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> IActionResult Welcome(<span style=color:#cdcaa9;font-weight:700>string</span> name, <span style=color:#cdcaa9;font-weight:700>int</span> numTimes = <span style=color:#0086f7;font-weight:700>1</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    ViewData[<span style=color:#0086d2>&#34;Message&#34;</span>] = <span style=color:#0086d2>&#34;Hello &#34;</span> + name;
</span></span><span style=display:flex><span>    ViewData[<span style=color:#0086d2>&#34;NumTimes&#34;</span>] = numTimes;
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>return</span> View();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=utilisation-dans-la-vue>Utilisation dans la vue
<span><a href=#utilisation-dans-la-vue><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>@{
</span></span><span style=display:flex><span>    ViewData[<span style=color:#0086d2>&#34;Title&#34;</span>] = <span style=color:#0086d2>&#34;Welcome&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>&lt;h2&gt;Welcome&lt;/h2&gt;
</span></span><span style=display:flex><span>&lt;ul&gt;
</span></span><span style=display:flex><span>    @for (<span style=color:#cdcaa9;font-weight:700>int</span> i = <span style=color:#0086f7;font-weight:700>0</span>; i &lt; (<span style=color:#cdcaa9;font-weight:700>int</span>)ViewData[<span style=color:#0086d2>&#34;NumTimes&#34;</span>]; i++)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        &lt;li&gt;@ViewData[<span style=color:#0086d2>&#34;Message&#34;</span>]&lt;/li&gt;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>&lt;/ul&gt;
</span></span></code></pre></div></section></section><section><section data-shortcode-section><h3 id=envoi-de-données-aux-vues--viewmodel>Envoi de données aux vues : ViewModel
<span><a href=#envoi-de-donn%c3%a9es-aux-vues--viewmodel><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Approche <em>fortement typée</em> : on définit une classe pour porter les données de la vue.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> Address
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Name { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Street { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> City { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> State { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> PostalCode { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=utilisation-dans-le-contrôleur>Utilisation dans le contrôleur
<span><a href=#utilisation-dans-le-contr%c3%b4leur><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> IActionResult Contact()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#cdcaa9;font-weight:700>var</span> viewModel = <span style=color:#fb660a;font-weight:700>new</span> Address()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        Name = <span style=color:#0086d2>&#34;Microsoft&#34;</span>,
</span></span><span style=display:flex><span>        Street = <span style=color:#0086d2>&#34;One Microsoft Way&#34;</span>,
</span></span><span style=display:flex><span>        City = <span style=color:#0086d2>&#34;Redmond&#34;</span>,
</span></span><span style=display:flex><span>        State = <span style=color:#0086d2>&#34;WA&#34;</span>,
</span></span><span style=display:flex><span>        PostalCode = <span style=color:#0086d2>&#34;98052-6399&#34;</span>
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>return</span> View(viewModel);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=utilisation-dans-la-vue>Utilisation dans la vue
<span><a href=#utilisation-dans-la-vue><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>@model WebApplication1.ViewModels.Address
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#fb660a;font-weight:700>h2</span>&gt;Contact&lt;/<span style=color:#fb660a;font-weight:700>h2</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#fb660a;font-weight:700>address</span>&gt;
</span></span><span style=display:flex><span>  @Model.Street&lt;<span style=color:#fb660a;font-weight:700>br</span> /&gt;
</span></span><span style=display:flex><span>  @Model.City, @Model.State @Model.PostalCode&lt;<span style=color:#fb660a;font-weight:700>br</span> /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#fb660a;font-weight:700>abbr</span> <span style=color:#ff0086;font-weight:700>title</span>=<span style=color:#0086d2>&#34;Phone&#34;</span>&gt;P:&lt;/<span style=color:#fb660a;font-weight:700>abbr</span>&gt; 425.555.0100
</span></span><span style=display:flex><span>&lt;/<span style=color:#fb660a;font-weight:700>address</span>&gt;
</span></span></code></pre></div></section></section><section><section data-shortcode-section><h3 id=view-layout>View layout
<span><a href=#view-layout><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Par défaut, toutes les vues partagent une structure commune définie dans le fichier <code>Views/Shared/_Layout.cshtml</code>.</li><li>Dans ce layout, la fonction <code>@RenderBody()</code> permet de générer le contenu spécifique de la vue à afficher.</li><li>Les éléments spécifiques à une vue (exemples : inclusions CSS ou JavaScript) peuvent être rassemblés dans des <strong>sections</strong> affichées par le layout.</li></ul></section><section><h3 id=exemple-de-layout>Exemple de layout
<span><a href=#exemple-de-layout><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#ff0007;background-color:#0f140f;font-weight:700;font-style:italic>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#fb660a;font-weight:700>html</span> <span style=color:#ff0086;font-weight:700>lang</span>=<span style=color:#0086d2>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#fb660a;font-weight:700>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#fb660a;font-weight:700>meta</span> <span style=color:#ff0086;font-weight:700>charset</span>=<span style=color:#0086d2>&#34;utf-8&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#fb660a;font-weight:700>title</span>&gt;@ViewData[&#34;Title&#34;] - Movie App&lt;/<span style=color:#fb660a;font-weight:700>title</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>&lt;!-- ... --&gt;</span>
</span></span><span style=display:flex><span>  &lt;/<span style=color:#fb660a;font-weight:700>head</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#fb660a;font-weight:700>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#fb660a;font-weight:700>header</span>&gt;<span style=color:#080;background-color:#0f140f;font-style:italic>&lt;!-- ... --&gt;</span>&lt;/<span style=color:#fb660a;font-weight:700>header</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#fb660a;font-weight:700>div</span> <span style=color:#ff0086;font-weight:700>class</span>=<span style=color:#0086d2>&#34;container&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#fb660a;font-weight:700>main</span> <span style=color:#ff0086;font-weight:700>role</span>=<span style=color:#0086d2>&#34;main&#34;</span> <span style=color:#ff0086;font-weight:700>class</span>=<span style=color:#0086d2>&#34;pb-3&#34;</span>&gt;@RenderBody()&lt;/<span style=color:#fb660a;font-weight:700>main</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#fb660a;font-weight:700>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#fb660a;font-weight:700>footer</span>&gt;<span style=color:#080;background-color:#0f140f;font-style:italic>&lt;!-- ... --&gt;</span>&lt;/<span style=color:#fb660a;font-weight:700>footer</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#fb660a;font-weight:700>script</span> <span style=color:#ff0086;font-weight:700>src</span>=<span style=color:#0086d2>&#34;~/lib/jquery/dist/jquery.min.js&#34;</span>&gt;&lt;/<span style=color:#fb660a;font-weight:700>script</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>&lt;!-- ... --&gt;</span>
</span></span><span style=display:flex><span>    @await RenderSectionAsync(&#34;Scripts&#34;, required: false)
</span></span><span style=display:flex><span>  &lt;/<span style=color:#fb660a;font-weight:700>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#fb660a;font-weight:700>html</span>&gt;
</span></span></code></pre></div></section></section><section><h3 id=validation-des-données>Validation des données
<span><a href=#validation-des-donn%c3%a9es><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>L&rsquo;annotation des classes du Modèle permet de définir des <strong>règles de validation</strong> qui seront automatiquement vérifiées à la fois côté serveur et côté client.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> System.ComponentModel.DataAnnotations;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> LoginViewModel
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Required]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [EmailAddress]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Email { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>
</span></span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Required]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [DataType(DataType.Password)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>string</span> Password { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>
</span></span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Display(Name = &#34;Remember me?&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#cdcaa9;font-weight:700>bool</span> RememberMe { <span style=color:#fb660a;font-weight:700>get</span>; <span style=color:#fb660a;font-weight:700>set</span>; }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=validation-dans-le-contrôleur>Validation dans le contrôleur
<span><a href=#validation-dans-le-contr%c3%b4leur><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task&lt;IActionResult&gt; Login(LoginViewModel model, <span style=color:#cdcaa9;font-weight:700>string</span> returnUrl = <span style=color:#fb660a;font-weight:700>null</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// Check model validation rules</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>if</span> (ModelState.IsValid)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#080;background-color:#0f140f;font-style:italic>// ... (nominal case: work with the model)</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// At this point, something failed: redisplay form</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>return</span> View(model);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h2 id=tests>Tests
<span><a href=#tests><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2></section><section><h3 id=typologie-des-tests>Typologie des tests
<span><a href=#typologie-des-tests><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><strong>Test unitaire</strong> (TU) : vérifie un composant individuel de l&rsquo;application.</li><li><strong>Test d&rsquo;intégration</strong> : vérifie les interactions entre différents composants de l&rsquo;application, y compris des composants externes comme une base de données ou un service web.</li><li><strong>Test fonctionnel (ou test de validation)</strong> : vérifie que l&rsquo;application fonctionne comme prévu du point de vue de l&rsquo;utilisateur.</li></ul></section><section><h3 id=tests-unitaires-vs-tests-dintégration>Tests unitaires Vs tests d&rsquo;intégration
<span><a href=#tests-unitaires-vs-tests-dint%c3%a9gration><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Ils sont tous deux automatisés.</li><li>Les TU isolent le composant à tester du reste de l&rsquo;application à l&rsquo;aide de <em>test doubles</em> (parfois appelés <em>dummies</em>, <em>stubs</em> ou encore <em>mocks</em>) qui simulent le comportement des autres composants. Leur exécution est rapide.</li><li>Les tests d&rsquo;intégration se basent sur les véritables composants de l&rsquo;application. Leur mise en place est souvent plus complexe et leur exécution plus lente.</li></ul></section><section><h3 id=quelle-stratégie-adopter->Quelle stratégie adopter ?
<span><a href=#quelle-strat%c3%a9gie-adopter-><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li>Vouloir tester tous les scénarios et configurations possibles est coûteux et pas forcément efficace.</li><li>Il est préférable de se concentrer sur les éléments-clés offrant le meilleur rapport coût/bénéfices : composants essentiels, opérations élémentaires (CRUD), principaux services de l&rsquo;application&mldr;</li><li>Des <em>smoke tests</em> vérifiant uniquement le renvoi d&rsquo;un code HTTP de succès pour chaque route peuvent constituer un premier filet de sécurité.</li></ul></section><section><h3 id=etapes-dun-test--le-patron-aaa>Etapes d&rsquo;un test : le patron AAA
<span><a href=#etapes-dun-test--le-patron-aaa><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><ul><li><em>Arrange</em> : préparation du test.<ul><li>Lancement de l&rsquo;application ;</li><li>Préparation de la base de données ;</li><li>&mldr;</li></ul></li><li><em>Act</em> : réalisation des opérations à tester.</li><li><em>Assert</em> : vérification des résultats des actions précédentes au moyen d&rsquo;<a href=https://en.wikipedia.org/wiki/Assertion_(software_development)>assertions</a>.</li></ul></section><section><h3 id=création-dun-projet-de-test-net>Création d&rsquo;un projet de test .NET
<span><a href=#cr%c3%a9ation-dun-projet-de-test-net><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet new xunit -o &lt;TestProjectName></code></p><p><a href=https://xunit.net/>xUnit</a> est un framework de tests unitaires <em>open source</em> pour la plate-forme .NET.</p><p><code>> dotnet add ./&lt;TestProjectName>/&lt;TestProjectName>.csproj reference ./&lt;ProjectName>/&lt;ProjectName>.csproj</code></p><p>Ajoute au projet de test une référence vers le projet à tester (les deux étant situés dans le même répertoire parent).</p></section><section><h3 id=exemple-de-classe-de-test>Exemple de classe de test
<span><a href=#exemple-de-classe-de-test><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>[Fact]</code> indique une méthode de test.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> Xunit;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>namespace</span> Prime.UnitTests.Services
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> PrimeService_IsPrimeShould
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>        [Fact]</span>
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> IsPrime_InputIs1_ReturnFalse()
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#080;background-color:#0f140f;font-style:italic>// Arrange</span>
</span></span><span style=display:flex><span>            <span style=color:#cdcaa9;font-weight:700>var</span> primeService = <span style=color:#fb660a;font-weight:700>new</span> PrimeService();
</span></span><span style=display:flex><span>            <span style=color:#080;background-color:#0f140f;font-style:italic>// Act</span>
</span></span><span style=display:flex><span>            <span style=color:#cdcaa9;font-weight:700>bool</span> result = primeService.IsPrime(<span style=color:#0086f7;font-weight:700>1</span>);
</span></span><span style=display:flex><span>            <span style=color:#080;background-color:#0f140f;font-style:italic>// Assert</span>
</span></span><span style=display:flex><span>            Assert.False(result, <span style=color:#0086d2>&#34;1 should not be prime&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=initialisation-du-test>Initialisation du test
<span><a href=#initialisation-du-test><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Permet d&rsquo;éviter la duplication de code.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>ppublic <span style=color:#fb660a;font-weight:700>class</span> PrimeService_IsPrimeShould
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>private</span> <span style=color:#fb660a;font-weight:700>readonly</span> PrimeService _primeService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> PrimeService_IsPrimeShould()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// Create instance of tested class</span>
</span></span><span style=display:flex><span>        _primeService = <span style=color:#fb660a;font-weight:700>new</span> PrimeService();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span></code></pre></div></section><section><h3 id=paramétrage-des-méthodes-de-test>Paramétrage des méthodes de test
<span><a href=#param%c3%a9trage-des-m%c3%a9thodes-de-test><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Theory]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(2)]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(3)]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(5)]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(7)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>void</span> IsPrime_PrimesLessThan10_ReturnTrue(<span style=color:#cdcaa9;font-weight:700>int</span> <span style=color:#fb660a;font-weight:700>value</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#cdcaa9;font-weight:700>var</span> result = _primeService.IsPrime(<span style=color:#fb660a;font-weight:700>value</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Assert.True(result, <span style=color:#0086d2>$&#34;{value} should be prime&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=exécution-des-tests>Exécution des tests
<span><a href=#ex%c3%a9cution-des-tests><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet test</code></p><p><img src=images/dotnet_test_result.png alt="dotnet test result"></p></section><section><h3 id=configuration-dun-projet-de-test-pour-aspnet-core>Configuration d&rsquo;un projet de test pour ASP.NET Core
<span><a href=#configuration-dun-projet-de-test-pour-aspnet-core><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p><code>> dotnet add package Microsoft.AspNetCore.Mvc.Testing -v 5.0.12</code></p><p>Ajoute un package dédié aux tests dans cet environnement, ici dans une version adaptée à .NET 5.</p></section><section><h3 id=exemple-de-classe-de-test-1>Exemple de classe de test
<span><a href=#exemple-de-classe-de-test-1><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> System.Threading.Tasks;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> Microsoft.AspNetCore.Mvc.Testing;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>using</span> Xunit;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>namespace</span> MvcMovie.Tests
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>class</span> HomeControllerTests
</span></span><span style=display:flex><span>    : IClassFixture&lt;WebApplicationFactory&lt;MvcMovie.Startup&gt;&gt;
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>private</span> <span style=color:#fb660a;font-weight:700>readonly</span> WebApplicationFactory&lt;MvcMovie.Startup&gt; _factory;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>public</span> HomeControllerTests(WebApplicationFactory&lt;MvcMovie.Startup&gt; factory)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            _factory = factory;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span></code></pre></div></section><section><h3 id=smoke-testing-dun-contrôleur>Smoke testing d&rsquo;un contrôleur
<span><a href=#smoke-testing-dun-contr%c3%b4leur><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [Theory]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(&#34;/&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(&#34;/Home/Index&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#ff0086;font-weight:700>    [InlineData(&#34;/Home/Privacy&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>public</span> <span style=color:#fb660a;font-weight:700>async</span> Task Get_EndpointsReturnSuccessAndCorrectContentType(<span style=color:#cdcaa9;font-weight:700>string</span> url)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// Arrange</span>
</span></span><span style=display:flex><span>        <span style=color:#cdcaa9;font-weight:700>var</span> client = _factory.CreateClient();
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// Act</span>
</span></span><span style=display:flex><span>        <span style=color:#cdcaa9;font-weight:700>var</span> response = <span style=color:#fb660a;font-weight:700>await</span> client.GetAsync(url);
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>// Assert</span>
</span></span><span style=display:flex><span>        response.EnsureSuccessStatusCode(); <span style=color:#080;background-color:#0f140f;font-style:italic>// Status Code 200-299</span>
</span></span><span style=display:flex><span>        Assert.Equal(<span style=color:#0086d2>&#34;text/html; charset=utf-8&#34;</span>,
</span></span><span style=display:flex><span>            response.Content.Headers.ContentType.ToString());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section></div></div><div><a href=https://ensc.bordeaux-inp.fr><img src=https://www.bpesquet.fr/images/ENSC_2022.jpg style=position:absolute;bottom:10px;left:10px></a></div><script src=https://www.bpesquet.fr/reveal.js/dist/reveal.js></script>
<script src=https://www.bpesquet.fr/reveal.js/plugin/math/math.js></script>
<script>Reveal.initialize({history:!1,slideNumber:!0,transition:"convex",math:{mathjax:"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js",config:"TeX-MML-AM_HTMLorMML"},dependencies:[{src:"https://www.bpesquet.fr/reveal.js/plugin/markdown/marked.js"},{src:"https://www.bpesquet.fr/reveal.js/plugin/markdown/markdown.js"},{src:"https://www.bpesquet.fr/reveal.js/plugin/notes/notes.js",async:!0},{src:"https://www.bpesquet.fr/reveal.js/plugin/zoom-js/zoom.js",async:!0},{src:"https://www.bpesquet.fr/reveal.js/plugin/highlight/highlight.js",async:!0,callback:function(){hljs.initHighlightingOnLoad()}}],plugins:[RevealMath]})</script></body></html>