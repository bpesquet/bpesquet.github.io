<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>React Native : gestion de l'état</title><link rel=stylesheet href=https://www.bpesquet.fr/reveal.js/dist/reveal.css><link rel=stylesheet href=https://www.bpesquet.fr/reveal.js/dist/theme/white.css></head><body><div class=reveal><div class=slides><section><h1>React Native : gestion de l'état</h1><p><a href=https://ensc.bordeaux-inp.fr>Ecole Nationale Supérieure de Cognitique</a></p><p><a href=https://www.bpesquet.fr>Baptiste Pesquet</a></p></section><section><h2 id=sommaire>Sommaire</h2><ul><li>Partage de l&rsquo;état entre composants</li><li>Centralisation de l&rsquo;état</li><li>Gestion de l&rsquo;état avec MobX</li></ul></section><section><h2 id=partage-de-létat-entre-composants>Partage de l&rsquo;état entre composants</h2></section><section><h2 id=rappels-sur-les-propriétés>Rappels sur les propriétés</h2><p><strong>Propriétés (<em>props</em>)</strong> = caractéristiques définies au moment de la création du composant.</p><p>Les propriétés sont modifiables uniquement par le composant parent.</p></section><section><h2 id=rappels-sur-létat>Rappels sur l&rsquo;état</h2><p><strong>Etat (<em>state</em>)</strong> = ensemble des données susceptibles d&rsquo;être modifiées pendant l&rsquo;exécution de l&rsquo;application.</p><p>Chaque composant React Native possède un état interne, géré avec <code>this.state</code> et <code>this.setState()</code>.</p><p>Toute modification de l&rsquo;état déclenche un nouveau rendu du composant.</p></section><section><h2 id=problématique>Problématique</h2><p>La gestion locale de l&rsquo;état devient insuffisante lorsqu&rsquo;un composant doit <strong>accéder à</strong> ou <strong>modifier</strong> l&rsquo;état d&rsquo;un autre composant.</p><p>Nécessité de partager un état commun entre certains composants.</p></section><section><h2 id=solution--_lifting-state-up_>Solution : <em>&ldquo;lifting state up&rdquo;</em></h2><ul><li>Remonter l&rsquo;état au niveau du plus proche composant parent commun.</li><li>Définir les actions de modification dans ce composant parent.</li><li>Dans les composants enfants :<ul><li>Remplacer l&rsquo;état local par des propriétés définies par le parent.</li><li>Remplacer les actions locales par des appels aux actions définies dans le parent.</li></ul></li></ul><p><a href=https://reactjs.org/docs/lifting-state-up.html>Lifting State Up (React)</a></p></section><section><h2 id=application>Application</h2><p><a href=https://github.com/ensc-mobi/TempConverter>https://github.com/ensc-mobi/TempConverter</a></p><p><img src=images/temp-converter.png alt="TempConverter demo"></p></section><section><h2 id=utilisation-de-props-dans-les-composants-enfants>Utilisation de props dans les composants enfants</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TemperatureInput</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>Component</span> {
  <span style=color:#a6e22e>_onChangeText</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>text</span> =&gt; {
    <span style=color:#75715e>// Callback passed as component prop is called
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>onTemperatureChange</span>(<span style=color:#a6e22e>text</span>);
  };

  <span style=color:#a6e22e>render</span>() {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>temperature</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>temperature</span>;
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>scale</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>scale</span>;
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>placeholder</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`Enter temperature in </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>scaleNames</span>[<span style=color:#a6e22e>scale</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
    <span style=color:#66d9ef>return</span> (
      &lt;<span style=color:#f92672>TextInput</span>
        <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>styles</span>.<span style=color:#a6e22e>text</span>}
        <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>placeholder</span>}
        <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>temperature</span>}
        <span style=color:#a6e22e>onChangeText</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_onChangeText</span>}
      /&gt;
    );
  }
}
</code></pre></div></section><section><h2 id=remontée-de-létat-dans-le-composant-parent>Remontée de l&rsquo;état dans le composant parent</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Calculator</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>Component</span> {
  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>props</span>) {
    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>props</span>);
    <span style=color:#75715e>// Common state is lifted in closest parent of TemperatureInput components
</span><span style=color:#75715e></span>    <span style=color:#75715e>// Temperature can be set either in Celsius or in Fahrenheit
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>temperature</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>scale</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;c&#34;</span> };
  }

  <span style=color:#a6e22e>_onCelsiusChange</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>temperature</span> =&gt; {
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>({ <span style=color:#a6e22e>scale</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;c&#34;</span>, <span style=color:#a6e22e>temperature</span> });
  };

  <span style=color:#a6e22e>_onFahrenheitChange</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>temperature</span> =&gt; {
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>({ <span style=color:#a6e22e>scale</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;f&#34;</span>, <span style=color:#a6e22e>temperature</span> });
  };
  <span style=color:#75715e>// ...
</span></code></pre></div></section><section><h2 id=appel-aux-actions-définies-dans-le-parent>Appel aux actions définies dans le parent</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx>  <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>render</span>() {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>scale</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>scale</span>;
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>temperature</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>temperature</span>;
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tempCelsius</span> <span style=color:#f92672>=</span>
      <span style=color:#a6e22e>scale</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;f&#34;</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>tryConvert</span>(<span style=color:#a6e22e>temperature</span>, <span style=color:#a6e22e>toCelsius</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>temperature</span>;
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tempFahrenheit</span> <span style=color:#f92672>=</span>
      <span style=color:#a6e22e>scale</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;c&#34;</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>tryConvert</span>(<span style=color:#a6e22e>temperature</span>, <span style=color:#a6e22e>toFahrenheit</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>temperature</span>;

    <span style=color:#66d9ef>return</span> (
      &lt;<span style=color:#f92672>View</span>&gt;
        &lt;<span style=color:#f92672>TemperatureInput</span>
          <span style=color:#a6e22e>scale</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;c&#34;</span>
          <span style=color:#a6e22e>temperature</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>tempCelsius</span>}
          <span style=color:#a6e22e>onTemperatureChange</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_onCelsiusChange</span>}
        /&gt;
        &lt;<span style=color:#f92672>TemperatureInput</span>
          <span style=color:#a6e22e>scale</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;f&#34;</span>
          <span style=color:#a6e22e>temperature</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>tempFahrenheit</span>}
          <span style=color:#a6e22e>onTemperatureChange</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_onFahrenheitChange</span>}
        /&gt;
        &lt;<span style=color:#f92672>BoilingResult</span> <span style=color:#a6e22e>tempCelsius</span><span style=color:#f92672>=</span>{parseFloat(<span style=color:#a6e22e>tempCelsius</span>)} /&gt;
      &lt;/<span style=color:#f92672>View</span>&gt;
    );
  }
</code></pre></div></section><section><h2 id=centralisation-de-létat>Centralisation de l&rsquo;état</h2></section><section><h2 id=problématique-1>Problématique</h2><p>Les composants parents rassemblent trop de choses :</p><ul><li>Etat commun</li><li>Actions de modification</li><li>Hiérarchie des composants enfants</li></ul><p>Non-respect du principe de séparation des responsabilités.</p></section><section><h2 id=solution>Solution</h2><ul><li>Centraliser l&rsquo;état et les actions de modifications dans des objets dédiés, souvent appelés <strong>stores</strong>.</li><li>Donner accès à ces objets aux composants via des propriétés.</li><li>Prévoir un mécanisme d'<strong>abonnement</strong> des composants aux mutations de l&rsquo;état effectués uniquement dans les stores.</li></ul></section><section><h2 id=application-1>Application</h2><p><a href=https://github.com/ensc-mobi/TodoNative>https://github.com/ensc-mobi/TodoNative</a></p><p><img src=images/todonative.png alt="TodoNative demo"></p></section><section><h2 id=définition-dun-store>Définition d&rsquo;un store</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TodoStore</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Store</span> {
  <span style=color:#a6e22e>constructor</span>() {
    <span style=color:#75715e>// Call to parent constructor is needed to init observation
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>super</span>();

    <span style=color:#75715e>// The TODO task is used as key (unique identifier)
</span><span style=color:#75715e></span>    <span style=color:#75715e>// Therefore, each TODO must have a different task
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>todos</span> <span style=color:#f92672>=</span> [];
  }

  <span style=color:#a6e22e>addTodo</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>task</span> =&gt; {
    <span style=color:#75715e>// Add new TODO at beginning of array
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>todos</span> <span style=color:#f92672>=</span> [{ <span style=color:#a6e22e>task</span>, <span style=color:#a6e22e>completed</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span> }, ...<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>todos</span>];

    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>notifyObservers</span>();
  };

  <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>
  <span style=color:#75715e>// Used in parent class when notifying observers
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>getState</span>() {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>todos</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>todos</span>;
    <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>todos</span> };
  }
}
</code></pre></div></section><section><h2 id=notification-des-changements-détat>Notification des changements d&rsquo;état</h2><p>Basée sur le Design Pattern <a href=https://fr.wikipedia.org/wiki/Observateur_%28patron_de_conception%29>Observateur</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Store</span> {
  <span style=color:#a6e22e>constructor</span>() {
    <span style=color:#75715e>// Define an empty observer list
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>observers</span> <span style=color:#f92672>=</span> [];
  }

  <span style=color:#75715e>// Add new observer to list
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>addObserver</span>(<span style=color:#a6e22e>observer</span>) {
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>observers</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>observer</span>);
  }

  <span style=color:#75715e>// Notify all observers of a state change in the store
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>notifyObservers</span>() {
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>observers</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>observer</span> =&gt; <span style=color:#a6e22e>observer</span>.<span style=color:#a6e22e>setState</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getState</span>()));
  }
}
</code></pre></div></section><section><h2 id=lien-entre-store-et-composant-principal>Lien entre store et composant principal</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>App</span> <span style=color:#f92672>=</span> () =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>todoStore</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>TodoStore</span>();

  <span style=color:#66d9ef>return</span> &lt;<span style=color:#f92672>MainView</span> <span style=color:#a6e22e>todoStore</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>todoStore</span>} /&gt;;
};

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>App</span>;
</code></pre></div></section><section><h2 id=abonnement-dun-composant>Abonnement d&rsquo;un composant</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainView</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>Component</span> {
  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>props</span>) {
    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>props</span>);
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>todoStore</span>.<span style=color:#a6e22e>getState</span>();
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>todoStore</span>.<span style=color:#a6e22e>addObserver</span>(<span style=color:#66d9ef>this</span>);
  }

  <span style=color:#a6e22e>render</span>() {
    <span style=color:#66d9ef>return</span> (
      &lt;<span style=color:#f92672>View</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>styles</span>.<span style=color:#a6e22e>container</span>}&gt;
        &lt;<span style=color:#f92672>Header</span> <span style=color:#a6e22e>title</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;TodoNative&#34;</span> /&gt;
        &lt;<span style=color:#f92672>Input</span>
          <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Saisissez une nouvelle tâche&#34;</span>
          <span style=color:#a6e22e>onSubmitEditing</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>todoStore</span>.<span style=color:#a6e22e>addTodo</span>}
        /&gt;
        <span style=color:#75715e>// ...
</span></code></pre></div></section><section><h2 id=gestion-de-létat-avec-mobx>Gestion de l&rsquo;état avec MobX</h2></section><section><h2 id=problématique-2>Problématique</h2><ul><li>Le nombre croissant de composants complique les évolutions de l&rsquo;état.</li><li>Les mutations de l&rsquo;état peuvent déclencher un (trop) grand nombre de rendus des composants.</li></ul></section><section><h2 id=solution-1>Solution</h2><ul><li>Utiliser une librairie dédiée à la gestion de l&rsquo;état.</li><li><a href=https://www.robinwieruch.de/redux-mobx-confusion/>Bon choix</a> pour la plupart des projets de taille intermédiaire : <a href=https://mobx.js.org>MobX</a>.</li></ul><p><img src=images/mobx-logo.png alt="MobX logo"></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># Add MobX to a React Native project</span>
expo install mobx mobx-react
expo install --save-dev babel-preset-mobx
</code></pre></div></section><section><p><img src=images/mobx-overview.png alt="MobX overview"></p></section><section><h2 id=application-2>Application</h2><p><a href=https://github.com/ensc-mobi/TodoNative-MobX>https://github.com/ensc-mobi/TodoNative-MobX</a></p><p><img src=images/todonative.png alt="TodoNative-MobX demo"></p></section><section><h2 id=définition-dune-classe-métier>Définition d&rsquo;une classe métier</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>observable</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;mobx&#34;</span>;

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Todo</span> {
  <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>observable</span> <span style=color:#a6e22e>task</span>;
  <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>observable</span> <span style=color:#a6e22e>completed</span>;

  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>task</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>completed</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>) {
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>task</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>task</span>;
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>completed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>completed</span>;
  }

  <span style=color:#a6e22e>toggle</span>() {
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>completed</span> <span style=color:#f92672>=</span> <span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>completed</span>;
  }
}
</code></pre></div></section><section><h2 id=définition-dun-store-1>Définition d&rsquo;un store</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>observable</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;mobx&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Todo</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;../domain/Todo&#34;</span>;

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TodoStore</span> {
  <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>observable</span> <span style=color:#a6e22e>todos</span>;
  <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>observable</span> <span style=color:#a6e22e>isLoading</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;

  <span style=color:#a6e22e>constructor</span>() {
    <span style=color:#75715e>// The TODO task is used as key (unique identifier)
</span><span style=color:#75715e></span>    <span style=color:#75715e>// Therefore, each TODO must have a different task
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>todos</span> <span style=color:#f92672>=</span> [];
  }

  <span style=color:#a6e22e>addTodo</span>(<span style=color:#a6e22e>task</span>) {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>todo</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Todo</span>(<span style=color:#a6e22e>task</span>);
    <span style=color:#75715e>// Add new TODO at beginning of array
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>todos</span> <span style=color:#f92672>=</span> [<span style=color:#a6e22e>todo</span>, ...<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>todos</span>];
  }

  <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>}
</code></pre></div></section><section><h2 id=lien-entre-store-et-composant-principal-1>Lien entre store et composant principal</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>App</span> <span style=color:#f92672>=</span> () =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>todoStore</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>TodoStore</span>();

  <span style=color:#66d9ef>return</span> &lt;<span style=color:#f92672>MainView</span> <span style=color:#a6e22e>todoStore</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>todoStore</span>} /&gt;;
};

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>App</span>;
</code></pre></div></section><section><h2 id=abonnement-dun-composant-1>Abonnement d&rsquo;un composant</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>observer</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;mobx-react&#34;</span>;
<span style=color:#75715e>// ...
</span><span style=color:#75715e></span>
<span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>observer</span>
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainView</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>Component</span> {
  <span style=color:#a6e22e>onAddTodo</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>task</span> =&gt; {
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>todoStore</span>.<span style=color:#a6e22e>addTodo</span>(<span style=color:#a6e22e>task</span>);
  };
  <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>  
  <span style=color:#a6e22e>render</span>() {
    <span style=color:#66d9ef>return</span> (
      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>View</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>styles</span>.<span style=color:#a6e22e>container</span>}<span style=color:#f92672>&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Header</span> <span style=color:#a6e22e>title</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;TodoNative&#34;</span> <span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Input</span>
          <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Saisissez une nouvelle tâche&#34;</span>
          <span style=color:#a6e22e>onSubmitEditing</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>onAddTodo</span>}
        <span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>FlatList</span>
          <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>styles</span>.<span style=color:#a6e22e>todoContainer</span>}
          <span style=color:#a6e22e>data</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>todoStore</span>.<span style=color:#a6e22e>todos</span>}
          <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>}
</code></pre></div></section><section><h2 id=pourquoi-pas-redux->Pourquoi pas Redux ?</h2><p><img src=images/redux-all.jpeg alt="Redux all!"></p><ul><li>Librairie créée pour adresser des problématiques à l&rsquo;échelle de Facebook</li><li>Complexe et <em>overkill</em> pour les projets &ldquo;normaux&rdquo;</li><li><a href=https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367>&ldquo;You might not need Redux&rdquo;</a> (écrit par son créateur)</li></ul></section></div></div><div><a href=https://ensc.bordeaux-inp.fr><img src=https://www.bpesquet.fr/images/ENSC.jpg style=position:absolute;bottom:10px;left:10px></a></div><script src=https://www.bpesquet.fr/reveal.js/dist/reveal.js></script><script>Reveal.initialize({history:false,slideNumber:true,transition:"convex",math:{mathjax:'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',config:'TeX-MML-AM_HTMLorMML'},dependencies:[{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/markdown\/marked.js'},{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/markdown\/markdown.js'},{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/notes\/notes.js',async:true},{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/zoom-js\/zoom.js',async:true},{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/highlight\/highlight.js',async:true,callback:function(){hljs.initHighlightingOnLoad();}},{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/math\/math.js',async:true}]});</script></body></html>