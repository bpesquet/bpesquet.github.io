<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Python best practices</title><link rel=stylesheet href=https://www.bpesquet.fr/reveal.js/dist/reveal.css><link rel=stylesheet href=https://www.bpesquet.fr/reveal.js/dist/theme/white.css></head><body><div class=reveal><div class=slides><section><h1>Python best practices</h1><p><a href=https://ensc.bordeaux-inp.fr>Ecole Nationale Sup√©rieure de Cognitique</a></p><p><a href=https://www.bpesquet.fr>Baptiste Pesquet</a></p></section><section><h2 id=table-of-contents>Table of contents</h2><ul><li>Writing pythonic code</li><li>Packaging and dependency management</li><li>Working with notebooks</li></ul></section><section><h2 id=writing-pythonic-code>Writing pythonic code</h2></section><section><h3 id=the-zen-of-python-by-tim-peters>The Zen of Python, by Tim Peters</h3><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#fb660a;font-weight:700>import</span> this
</code></pre></div><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>Beautiful is better than ugly.
Explicit is better than implicit.
Simple is better than complex.
Complex is better than complicated.
Flat is better than nested.
Sparse is better than dense.
Readability counts.
Special cases aren&#39;t special enough to break the rules.
Although practicality beats purity.
Errors should never pass silently.
Unless explicitly silenced.
In the face of ambiguity, refuse the temptation to guess.
There should be one-- and preferably only one --obvious way to do it.
Although that way may not be obvious at first unless you&#39;re Dutch.
Now is better than never.
Although never is often better than *right* now.
If the implementation is hard to explain, it&#39;s a bad idea.
If the implementation is easy to explain, it may be a good idea.
Namespaces are one honking great idea -- let&#39;s do more of those!
</code></pre></div></section><section><h3 id=what-does-pythonic-mean>What does &ldquo;pythonic&rdquo; mean?</h3><ul><li>Python code is considered <em>pythonic</em> if it:<ul><li>conforms to the Python philosophy;</li><li>takes advantage of the language&rsquo;s specific features.</li></ul></li><li>Pythonic code is <strong>idiomatic Python code</strong> that strives to be clean, concise and readable.</li></ul></section><section><h3 id=example-swapping-two-variables>Example: swapping two variables</h3><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;background-color:#0f140f;font-style:italic># Non-pythonic</span>
tmp = a
a = b
b = tmp

<span style=color:#080;background-color:#0f140f;font-style:italic># Pythonic</span>
a, b = b, a
</code></pre></div></section><section><h3 id=example-iterating-on-a-list>Example: iterating on a list</h3><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>my_list = [<span style=color:#0086d2>&#34;a&#34;</span>, <span style=color:#0086d2>&#34;b&#34;</span>, <span style=color:#0086d2>&#34;c&#34;</span>]

<span style=color:#080;background-color:#0f140f;font-style:italic># Non-pythonic</span>
i = <span style=color:#0086f7;font-weight:700>0</span>
<span style=color:#fb660a;font-weight:700>while</span> i &lt; len(my_list):
    do_something(my_list[i])
    i += <span style=color:#0086f7;font-weight:700>1</span>

<span style=color:#080;background-color:#0f140f;font-style:italic># Still non-pythonic</span>
<span style=color:#fb660a;font-weight:700>for</span> i in range(len(my_list)):
    do_something(my_list[i])

<span style=color:#080;background-color:#0f140f;font-style:italic># Pythonic</span>
<span style=color:#fb660a;font-weight:700>for</span> item in my_list:
    do_something(item)
</code></pre></div></section><section><h3 id=example-indexed-traversal>Example: indexed traversal</h3><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;background-color:#0f140f;font-style:italic># Non-pythonic</span>
<span style=color:#fb660a;font-weight:700>for</span> i in range(len(my_list)):
    <span style=color:#fb660a;font-weight:700>print</span>(i, <span style=color:#0086d2>&#34;-&gt;&#34;</span>, my_list[i])

<span style=color:#080;background-color:#0f140f;font-style:italic># Pythonic</span>
<span style=color:#fb660a;font-weight:700>for</span> i, item in enumerate(my_list):
    <span style=color:#fb660a;font-weight:700>print</span>(i, <span style=color:#0086d2>&#34;-&gt;&#34;</span>, item)
</code></pre></div></section><section><h3 id=example-searching-in-a-list>Example: searching in a list</h3><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>fruits = [<span style=color:#0086d2>&#34;apples&#34;</span>, <span style=color:#0086d2>&#34;oranges&#34;</span>, <span style=color:#0086d2>&#34;bananas&#34;</span>, <span style=color:#0086d2>&#34;grapes&#34;</span>]
fruit = <span style=color:#0086d2>&#34;cherries&#34;</span>

<span style=color:#080;background-color:#0f140f;font-style:italic># Non-pythonic</span>
found = False
size = len(fruits)
<span style=color:#fb660a;font-weight:700>for</span> i in range(<span style=color:#0086f7;font-weight:700>0</span>, size):
    <span style=color:#fb660a;font-weight:700>if</span> fruits[i] == fruit:
        found = True

<span style=color:#080;background-color:#0f140f;font-style:italic># Pythonic</span>
found = fruit in fruits
</code></pre></div></section><section><h3 id=example-generating-a-list>Example: generating a list</h3><p>This feature is called <a href=https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions>list comprehension</a>.</p><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>numbers = [<span style=color:#0086f7;font-weight:700>1</span>, <span style=color:#0086f7;font-weight:700>2</span>, <span style=color:#0086f7;font-weight:700>3</span>, <span style=color:#0086f7;font-weight:700>4</span>, <span style=color:#0086f7;font-weight:700>5</span>, <span style=color:#0086f7;font-weight:700>6</span>]

<span style=color:#080;background-color:#0f140f;font-style:italic># Non-pythonic</span>
squares = []
<span style=color:#fb660a;font-weight:700>for</span> i in range(len(numbers)):
    <span style=color:#fb660a;font-weight:700>if</span> numbers[i] % <span style=color:#0086f7;font-weight:700>2</span> == <span style=color:#0086f7;font-weight:700>0</span>:
        squares.append(numbers[i] * <span style=color:#0086f7;font-weight:700>2</span>)
    <span style=color:#fb660a;font-weight:700>else</span>:
        squares.append(numbers[i])

<span style=color:#080;background-color:#0f140f;font-style:italic># Pythonic</span>
squares = [x * <span style=color:#0086f7;font-weight:700>2</span> <span style=color:#fb660a;font-weight:700>if</span> x % <span style=color:#0086f7;font-weight:700>2</span> == <span style=color:#0086f7;font-weight:700>0</span> <span style=color:#fb660a;font-weight:700>else</span> x <span style=color:#fb660a;font-weight:700>for</span> x in numbers]
</code></pre></div></section><section><h3 id=code-style>Code style</h3><ul><li><a href=https://www.python.org/dev/peps/pep-0008/>PEP8</a> is the official style guide for Python:<ul><li>use 4 spaces for indetation;</li><li>define a maximum value for line length (around 80 characters);</li><li>organize imports at beginning of file;</li><li>surround binary operators with a single space on each side;</li><li>&mldr;</li></ul></li><li>Code style should be enforced upon creation by a tool like <a href=https://github.com/psf/black>black</a>.</li></ul></section><section><h3 id=beyond-pep8>Beyond PEP8</h3><p>Focusing on style and PEP8-compliance might make you miss more fundamental code imperfections.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/wf-BqAjZb8M style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div></section><section><h3 id=code-linting>Code linting</h3><ul><li><em>Linting</em> is the process of checking code for syntactical and stylistic problems before execution.</li><li>It is useful to catch errors and improve code quality in dynamically typed, interpreted languages, where there is no compiler.</li><li>Several linters exist in the Python ecosystem. The most commonly used is <a href=https://pylint.org/>pylint</a>.</li></ul></section><section><h3 id=type-annotations>Type annotations</h3><ul><li>Added in Python 3.5, <a href=https://www.python.org/dev/peps/pep-0484/>type annotations</a> allow to add type hints to code entities like variables or functions, bringing a statically typed flavour to the language.</li><li><a href=http://mypy-lang.org/>mypy</a> can automatically check the code for annotation correctness.</li></ul><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#fb660a;font-weight:700>def</span> <span style=color:#ff0086;font-weight:700>greeting</span>(name: str) -&gt; str:
    <span style=color:#fb660a;font-weight:700>return</span> <span style=color:#0086d2>&#39;Hello &#39;</span> + name

greeting(<span style=color:#0086d2>&#39;Alice&#39;</span>)  <span style=color:#080;background-color:#0f140f;font-style:italic># OK</span>
greeting(<span style=color:#0086f7;font-weight:700>3</span>)  <span style=color:#080;background-color:#0f140f;font-style:italic># mypy error: incompatible type &#34;int&#34;; expected &#34;str&#34;</span>
</code></pre></div></section><section><h2 id=packaging-and-dependency-management>Packaging and dependency management</h2></section><section><h3 id=managing-dependencies-in-python>Managing dependencies in Python</h3><ul><li>Most Python apps depend on third-party libraries and frameworks (NumPy, Flask, Requests&mldr;).</li><li>These tools may also have external dependencies, and so on.</li><li><strong>Dependency management</strong> is necessary to prevent version conflicts and incompatibilities. it involves two things:<ul><li>a way for the app to declare its dependencies;</li><li>a tool to resolve these dependencies and install compatible versions.</li></ul></li></ul></section><section><h3 id=semantic-versioning>Semantic versioning</h3><ul><li>Software versioning convention used in many ecosystems.</li><li>A version number comes as a suite of three digits <code>X.Y.Z</code>.<ul><li>X = major version (potentially including breaking changes).</li><li>Y = minor version (only non-breaking changes).</li><li>Z = patch.</li></ul></li><li>Digits are incremented as new versions are shipped.</li></ul></section><section><h3 id=pip-and-requirementstxt>pip and requirements.txt</h3><p>A <code>requirements.txt</code> file is the most basic way of declaring dependencies in Python.</p><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>certifi&gt;=2020.11.0
chardet==4.0.0
click&gt;=6.5.0, &lt;7.1
download==0.3.5
Flask&gt;=1.1.0
</code></pre></div><p>The <a href=https://pypi.org/project/pip/>pip</a> package installer can read this file and act accordingly, downloading dependencies from <a href=https://pypi.org/>PyPI</a>.</p><p><code>> pip install -r requirements.txt</code></p></section><section><h3 id=virtual-environments>Virtual environments</h3><ul><li>A <strong>virtual environment</strong> is an isolated Python environment where a project&rsquo;s dependencies are installed.</li><li>Using them prevents the risk of mixing dependencies required by different projects on the same machine.</li><li>Several tools exist to manage virtual environments in Python, for example <a href=https://virtualenv.pypa.io>virtualenv</a> and <a href=https://docs.conda.io>conda</a>.</li></ul></section><section><h3 id=conda-and-environmentyml>conda and environment.yml</h3><p>Installed as part of the <a href=https://www.anaconda.com/>Anaconda</a> distribution, the <a href=https://docs.conda.io>conda</a> package manager reads an <code>environment.yml</code> file to install the dependencies associated to a specific virtual environment.</p><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>example-env<span style=color:#888>
</span><span style=color:#888>
</span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>channels</span>:<span style=color:#888>
</span><span style=color:#888>  </span>- conda-forge<span style=color:#888>
</span><span style=color:#888>  </span>- defaults<span style=color:#888>
</span><span style=color:#888>
</span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>dependencies</span>:<span style=color:#888>
</span><span style=color:#888>  </span>- python=3.7<span style=color:#888>
</span><span style=color:#888>  </span>- matplotlib<span style=color:#888>
</span><span style=color:#888>  </span>- numpy<span style=color:#888>
</span></code></pre></div></section><section><h3 id=poetry>Poetry</h3><p>Based on a <code>pyproject.toml</code> file, <a href=https://python-poetry.org>Poetry</a> is a recent virtual environment, packaging and dependency management tool for Python.</p><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#080;background-color:#0f140f;font-style:italic># Create a new poetry-compliant project</span>
poetry new &lt;project name&gt;

<span style=color:#080;background-color:#0f140f;font-style:italic># Initialize an already existing project</span>
poetry init

<span style=color:#080;background-color:#0f140f;font-style:italic># Install defined dependencies</span>
poetry install
</code></pre></div></section><section><h3 id=the-pyprojecttoml-file>The pyproject.toml file</h3><p>Soon-to-be standard for configuring Python projects.</p><div class=highlight><pre style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[tool.poetry]
name = <span style=color:#0086d2>&#34;propetry example&#34;</span>
version = <span style=color:#0086d2>&#34;0.1.0&#34;</span>
description = <span style=color:#0086d2>&#34;&#34;</span>

[tool.poetry.dependencies]
python = <span style=color:#0086d2>&#34;^3.7&#34;</span>
jupyter = <span style=color:#0086d2>&#34;^1.0.0&#34;</span>
matplotlib = <span style=color:#0086d2>&#34;^3.3.2&#34;</span>
sklearn = <span style=color:#0086d2>&#34;^0.0&#34;</span>
pandas = <span style=color:#0086d2>&#34;^1.1.3&#34;</span>
ipython = <span style=color:#0086d2>&#34;^7.0.0&#34;</span>

[tool.poetry.dev-dependencies]
pytest = <span style=color:#0086d2>&#34;^6.1.1&#34;</span>
</code></pre></div></section><section><h3 id=caret-requirements>Caret requirements</h3><p>Offers a way to precisely define dependency versions.</p><table><thead><tr><th style=text-align:center>Requirement</th><th style=text-align:center>Versions allowed</th></tr></thead><tbody><tr><td style=text-align:center>^1.2.3</td><td style=text-align:center>>=1.2.3 &lt;2.0.0</td></tr><tr><td style=text-align:center>^1.2</td><td style=text-align:center>>=1.2.0 &lt;2.0.0</td></tr><tr><td style=text-align:center>~1.2.3</td><td style=text-align:center>>=1.2.3 &lt;1.3.0</td></tr><tr><td style=text-align:center>~1.2</td><td style=text-align:center>>=1.2.0 &lt;1.3.0</td></tr><tr><td style=text-align:center>1.2.3</td><td style=text-align:center>1.2.3 only</td></tr></tbody></table></section><section><h3 id=the-poetrylock-file>The poetry.lock file</h3><ul><li>The first time Poetry install dependencies, it creates a <code>poetry.lock</code> file that contains the exact versions of all installed packages.</li><li>Subsequent installs will use these exact versions to ensure consistency.</li><li>Removing this file and running another Poetry install will fetch the latest matching versions.</li></ul></section><section><h2 id=working-with-notebooks>Working with notebooks</h2></section><section><p>TODO</p></section></div></div><div><a href=https://ensc.bordeaux-inp.fr><img src=https://www.bpesquet.fr/images/ENSC.jpg style=position:absolute;bottom:10px;left:10px></a></div><script src=https://www.bpesquet.fr/reveal.js/dist/reveal.js></script><script src=https://www.bpesquet.fr/reveal.js/plugin/math/math.js></script><script>Reveal.initialize({history:false,slideNumber:true,transition:"convex",math:{mathjax:'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',config:'TeX-MML-AM_HTMLorMML'},dependencies:[{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/markdown\/marked.js'},{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/markdown\/markdown.js'},{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/notes\/notes.js',async:true},{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/zoom-js\/zoom.js',async:true},{src:'https:\/\/www.bpesquet.fr\/reveal.js\/plugin\/highlight\/highlight.js',async:true,callback:function(){hljs.initHighlightingOnLoad();}},],plugins:[RevealMath]});</script></body></html>